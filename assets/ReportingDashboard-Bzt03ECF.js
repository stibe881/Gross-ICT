import{Q as E,J as I,j as p,N as b,A as K,x as a}from"./index-BN9GAmQT.js";import{B as w}from"./button-B7XicF_D.js";import{C as n,a as l,b as i,d,c as u}from"./card-DDCG5iAJ.js";import{L as T}from"./loader-circle-ClqFH6Ch.js";import{A as U}from"./arrow-left-DYl8JD6p.js";import{L as O}from"./log-out-Del1bcAp.js";import{D as Y}from"./dollar-sign-BhOElyIN.js";import{F as J}from"./file-text-zOWEdpec.js";import{T as P}from"./trending-up-q9Xt4TNZ.js";import{U as G}from"./users-BEPVjVsG.js";import{R as D,C as y,X as v,Y as C,T as R,B as k,a as H}from"./generateCategoricalChart-B5qIq3um.js";import{B as A}from"./BarChart-UulCzpsw.js";import{P as Q,a as $}from"./PieChart-3gGku0Mc.js";import"./index-Ci_qB1WW.js";import"./index-CqUluVxK.js";function ia(){const{user:c,loading:F}=E(),[,h]=I(),[g,L]=p.useState(new Date().getFullYear()),B=!1,{data:r,isLoading:S}=b.invoices.all.useQuery({year:g},{enabled:!!c&&(c.role==="admin"||c.role==="accounting")}),{data:x}=b.customers.all.useQuery(void 0,{enabled:!!c&&(c.role==="admin"||c.role==="accounting")}),j=b.auth.logout.useMutation({onSuccess:()=>{K.success("Erfolgreich abgemeldet"),h("/login")}}),z=p.useMemo(()=>{if(!r)return[];const s=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],e=new Array(12).fill(0);return r.forEach(t=>{if(t.status==="paid"){const o=new Date(t.invoiceDate).getMonth();e[o]+=parseFloat(t.totalAmount)}}),s.map((t,o)=>({month:t,revenue:e[o]}))},[r]),f=p.useMemo(()=>{if(!r)return[];const s={};r.forEach(t=>{s[t.status]=(s[t.status]||0)+1});const e={draft:"Entwurf",sent:"Versendet",paid:"Bezahlt",overdue:"Überfällig",cancelled:"Storniert"};return Object.entries(s).map(([t,o])=>({name:e[t]||t,value:o}))},[r]),M=p.useMemo(()=>{if(!r||!x)return[];const s={};return r.forEach(e=>{if(e.status==="paid"){if(!s[e.customerId]){const t=x.find(o=>o.id===e.customerId);s[e.customerId]={name:t?.name||"Unbekannt",revenue:0}}s[e.customerId].revenue+=parseFloat(e.totalAmount)}}),Object.values(s).sort((e,t)=>t.revenue-e.revenue).slice(0,10)},[r,x]),N=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8"];if(F||B||S)return a.jsx("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:137",className:"min-h-screen flex items-center justify-center bg-black",children:a.jsx(T,{"data-loc":"client/src/pages/ReportingDashboard.tsx:138",className:"h-8 w-8 animate-spin text-primary"})});if(!c||!["admin","accounting"].includes(c.role))return h("/login"),null;const m=s=>new Intl.NumberFormat("de-CH",{style:"currency",currency:"CHF"}).format(s);return a.jsxs("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:156",className:"min-h-screen bg-black text-white",children:[a.jsx("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:158",className:"border-b border-white/10 bg-white/5 backdrop-blur-xl",children:a.jsx("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:159",className:"container mx-auto px-4 py-4",children:a.jsxs("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:160",className:"flex justify-between items-center",children:[a.jsxs("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:161",className:"flex items-center gap-4",children:[a.jsxs(w,{"data-loc":"client/src/pages/ReportingDashboard.tsx:162",variant:"ghost",size:"sm",onClick:()=>h("/accounting"),className:"text-gray-400 hover:text-white",children:[a.jsx(U,{"data-loc":"client/src/pages/ReportingDashboard.tsx:168",className:"h-4 w-4 mr-2"}),"Zurück"]}),a.jsxs("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:171",children:[a.jsx("h1",{"data-loc":"client/src/pages/ReportingDashboard.tsx:172",className:"text-xl md:text-2xl font-bold",children:"Reporting Dashboard"}),a.jsx("p",{"data-loc":"client/src/pages/ReportingDashboard.tsx:173",className:"text-xs md:text-sm text-gray-400",children:"Umsatz-Analysen und Statistiken"})]})]}),a.jsxs("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:176",className:"flex items-center gap-2",children:[a.jsx("select",{"data-loc":"client/src/pages/ReportingDashboard.tsx:177",value:g,onChange:s=>L(parseInt(s.target.value)),className:"bg-white/5 border border-white/10 text-white rounded px-3 py-1 text-sm",children:[2023,2024,2025,2026].map(s=>a.jsx("option",{"data-loc":"client/src/pages/ReportingDashboard.tsx:183",value:s,children:s},s))}),a.jsxs(w,{"data-loc":"client/src/pages/ReportingDashboard.tsx:188",variant:"outline",onClick:()=>j.mutate(),disabled:j.isPending,className:"border-white/20 bg-white/5 hover:bg-white/10",size:"sm",children:[a.jsx(O,{"data-loc":"client/src/pages/ReportingDashboard.tsx:195",className:"h-4 w-4 md:mr-2"}),a.jsx("span",{"data-loc":"client/src/pages/ReportingDashboard.tsx:196",className:"hidden md:inline",children:"Abmelden"})]})]})]})})}),a.jsxs("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:204",className:"container mx-auto px-4 py-8",children:[a.jsxs("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:206",className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[a.jsxs(n,{"data-loc":"client/src/pages/ReportingDashboard.tsx:207",className:"bg-white/5 border-white/10",children:[a.jsx(l,{"data-loc":"client/src/pages/ReportingDashboard.tsx:208",className:"pb-3",children:a.jsxs(i,{"data-loc":"client/src/pages/ReportingDashboard.tsx:209",className:"text-sm font-medium text-gray-400 flex items-center gap-2",children:[a.jsx(Y,{"data-loc":"client/src/pages/ReportingDashboard.tsx:210",className:"h-4 w-4"}),"Gesamtumsatz"]})}),a.jsxs(d,{"data-loc":"client/src/pages/ReportingDashboard.tsx:214",children:[a.jsx("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:215",className:"text-2xl font-bold text-white",children:m(0)}),a.jsx("p",{"data-loc":"client/src/pages/ReportingDashboard.tsx:218",className:"text-xs text-gray-400 mt-1",children:g})]})]}),a.jsxs(n,{"data-loc":"client/src/pages/ReportingDashboard.tsx:222",className:"bg-white/5 border-white/10",children:[a.jsx(l,{"data-loc":"client/src/pages/ReportingDashboard.tsx:223",className:"pb-3",children:a.jsxs(i,{"data-loc":"client/src/pages/ReportingDashboard.tsx:224",className:"text-sm font-medium text-gray-400 flex items-center gap-2",children:[a.jsx(J,{"data-loc":"client/src/pages/ReportingDashboard.tsx:225",className:"h-4 w-4"}),"Rechnungen"]})}),a.jsxs(d,{"data-loc":"client/src/pages/ReportingDashboard.tsx:229",children:[a.jsx("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:230",className:"text-2xl font-bold text-white",children:0}),a.jsx("p",{"data-loc":"client/src/pages/ReportingDashboard.tsx:231",className:"text-xs text-gray-400 mt-1",children:"Gesamt"})]})]}),a.jsxs(n,{"data-loc":"client/src/pages/ReportingDashboard.tsx:235",className:"bg-white/5 border-white/10",children:[a.jsx(l,{"data-loc":"client/src/pages/ReportingDashboard.tsx:236",className:"pb-3",children:a.jsxs(i,{"data-loc":"client/src/pages/ReportingDashboard.tsx:237",className:"text-sm font-medium text-gray-400 flex items-center gap-2",children:[a.jsx(P,{"data-loc":"client/src/pages/ReportingDashboard.tsx:238",className:"h-4 w-4"}),"Bezahlt"]})}),a.jsxs(d,{"data-loc":"client/src/pages/ReportingDashboard.tsx:242",children:[a.jsx("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:243",className:"text-2xl font-bold text-green-400",children:0}),a.jsxs("p",{"data-loc":"client/src/pages/ReportingDashboard.tsx:244",className:"text-xs text-gray-400 mt-1",children:[0,"%"]})]})]}),a.jsxs(n,{"data-loc":"client/src/pages/ReportingDashboard.tsx:250",className:"bg-white/5 border-white/10",children:[a.jsx(l,{"data-loc":"client/src/pages/ReportingDashboard.tsx:251",className:"pb-3",children:a.jsxs(i,{"data-loc":"client/src/pages/ReportingDashboard.tsx:252",className:"text-sm font-medium text-gray-400 flex items-center gap-2",children:[a.jsx(G,{"data-loc":"client/src/pages/ReportingDashboard.tsx:253",className:"h-4 w-4"}),"Kunden"]})}),a.jsxs(d,{"data-loc":"client/src/pages/ReportingDashboard.tsx:257",children:[a.jsx("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:258",className:"text-2xl font-bold text-white",children:x?.length||0}),a.jsx("p",{"data-loc":"client/src/pages/ReportingDashboard.tsx:259",className:"text-xs text-gray-400 mt-1",children:"Aktiv"})]})]})]}),a.jsxs("div",{"data-loc":"client/src/pages/ReportingDashboard.tsx:265",className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[a.jsxs(n,{"data-loc":"client/src/pages/ReportingDashboard.tsx:267",className:"bg-white/5 border-white/10",children:[a.jsxs(l,{"data-loc":"client/src/pages/ReportingDashboard.tsx:268",children:[a.jsx(i,{"data-loc":"client/src/pages/ReportingDashboard.tsx:269",className:"text-white",children:"Monatlicher Umsatz"}),a.jsxs(u,{"data-loc":"client/src/pages/ReportingDashboard.tsx:270",className:"text-gray-400",children:["Bezahlte Rechnungen nach Monat (",g,")"]})]}),a.jsx(d,{"data-loc":"client/src/pages/ReportingDashboard.tsx:274",children:a.jsx(D,{"data-loc":"client/src/pages/ReportingDashboard.tsx:275",width:"100%",height:300,children:a.jsxs(A,{"data-loc":"client/src/pages/ReportingDashboard.tsx:276",data:z,children:[a.jsx(y,{"data-loc":"client/src/pages/ReportingDashboard.tsx:277",strokeDasharray:"3 3",stroke:"#333"}),a.jsx(v,{"data-loc":"client/src/pages/ReportingDashboard.tsx:278",dataKey:"month",stroke:"#888"}),a.jsx(C,{"data-loc":"client/src/pages/ReportingDashboard.tsx:279",stroke:"#888"}),a.jsx(R,{"data-loc":"client/src/pages/ReportingDashboard.tsx:280",contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333"},formatter:s=>m(s)}),a.jsx(k,{"data-loc":"client/src/pages/ReportingDashboard.tsx:284",dataKey:"revenue",fill:"#8b5cf6"})]})})})]}),a.jsxs(n,{"data-loc":"client/src/pages/ReportingDashboard.tsx:291",className:"bg-white/5 border-white/10",children:[a.jsxs(l,{"data-loc":"client/src/pages/ReportingDashboard.tsx:292",children:[a.jsx(i,{"data-loc":"client/src/pages/ReportingDashboard.tsx:293",className:"text-white",children:"Rechnungsstatus"}),a.jsxs(u,{"data-loc":"client/src/pages/ReportingDashboard.tsx:294",className:"text-gray-400",children:["Verteilung nach Status (",g,")"]})]}),a.jsx(d,{"data-loc":"client/src/pages/ReportingDashboard.tsx:298",children:a.jsx(D,{"data-loc":"client/src/pages/ReportingDashboard.tsx:299",width:"100%",height:300,children:a.jsxs(Q,{"data-loc":"client/src/pages/ReportingDashboard.tsx:300",children:[a.jsx($,{"data-loc":"client/src/pages/ReportingDashboard.tsx:301",data:f,cx:"50%",cy:"50%",labelLine:!1,label:s=>`${s.name}: ${s.value}`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:f.map((s,e)=>a.jsx(H,{"data-loc":"client/src/pages/ReportingDashboard.tsx:312",fill:N[e%N.length]},`cell-${e}`))}),a.jsx(R,{"data-loc":"client/src/pages/ReportingDashboard.tsx:315",contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333"}})]})})})]})]}),a.jsxs(n,{"data-loc":"client/src/pages/ReportingDashboard.tsx:323",className:"bg-white/5 border-white/10",children:[a.jsxs(l,{"data-loc":"client/src/pages/ReportingDashboard.tsx:324",children:[a.jsx(i,{"data-loc":"client/src/pages/ReportingDashboard.tsx:325",className:"text-white",children:"Top 10 Kunden nach Umsatz"}),a.jsxs(u,{"data-loc":"client/src/pages/ReportingDashboard.tsx:326",className:"text-gray-400",children:["Bezahlte Rechnungen (",g,")"]})]}),a.jsx(d,{"data-loc":"client/src/pages/ReportingDashboard.tsx:330",children:a.jsx(D,{"data-loc":"client/src/pages/ReportingDashboard.tsx:331",width:"100%",height:400,children:a.jsxs(A,{"data-loc":"client/src/pages/ReportingDashboard.tsx:332",data:M,layout:"vertical",children:[a.jsx(y,{"data-loc":"client/src/pages/ReportingDashboard.tsx:333",strokeDasharray:"3 3",stroke:"#333"}),a.jsx(v,{"data-loc":"client/src/pages/ReportingDashboard.tsx:334",type:"number",stroke:"#888"}),a.jsx(C,{"data-loc":"client/src/pages/ReportingDashboard.tsx:335",dataKey:"name",type:"category",stroke:"#888",width:150}),a.jsx(R,{"data-loc":"client/src/pages/ReportingDashboard.tsx:336",contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333"},formatter:s=>m(s)}),a.jsx(k,{"data-loc":"client/src/pages/ReportingDashboard.tsx:340",dataKey:"revenue",fill:"#10b981"})]})})})]})]})]})}export{ia as default};
