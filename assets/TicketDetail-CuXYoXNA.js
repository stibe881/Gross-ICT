import{c as V,J as re,j as i,N as d,A as o,x as e,Q as me,T as Z}from"./index-BN9GAmQT.js";import{B as k}from"./button-B7XicF_D.js";import{I as J}from"./input-DAxyQcQ6.js";import{D as de,a as xe,b as pe,c as he,X as W}from"./dialog-BFxkyGdG.js";import{S as A,a as P,b as K,c as B,d as u}from"./select-lpC4X7iX.js";import{T as ue}from"./textarea-CUpb7IQY.js";import{C as ge,a as ke,b as De,d as Te}from"./card-DDCG5iAJ.js";import{B as b}from"./badge-DuBy3M6P.js";import{C as je}from"./checkbox-BA-qCqmw.js";import{L as fe}from"./label-WV9rmlgK.js";import{R as be}from"./receipt-UyHtgOCh.js";import{L as S}from"./loader-circle-ClqFH6Ch.js";import{U as ve}from"./user-DNKQZcJU.js";import{C as Ne}from"./calendar-lP7qctBn.js";import{M as X}from"./message-square-D2-VYrWV.js";import{F as we}from"./file-text-zOWEdpec.js";import{D as ye}from"./download-_y-9cJJ1.js";import{L as H}from"./lock-CN5MT7S2.js";import{B as Ce}from"./book-open-DJlXj3jr.js";import{S as Se}from"./search-DYS7RNfR.js";import{S as Fe}from"./send-C6irG-PM.js";const O=V("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);const Y=V("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);const Ie=V("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);function ze({open:n,onOpenChange:v,ticketId:y}){const[,D]=re(),[T,p]=i.useState(null),[g,r]=i.useState(""),[j,N]=i.useState("120"),[h,w]=i.useState(""),{data:C}=d.customers.all.useQuery(),{data:m}=d.invoiceFromTicket.getCustomerFromTicket.useQuery({ticketId:y},{enabled:n}),f=d.invoiceFromTicket.createFromTickets.useMutation({onSuccess:c=>{o.success(`Rechnung ${c.invoiceNumber} erfolgreich erstellt`),v(!1),D("/invoices")},onError:c=>{o.error(`Fehler: ${c.message}`)}});i.useEffect(()=>{m&&"id"in m&&p(m.id)},[m]),i.useEffect(()=>{if(n&&!g){const c=new Date;c.setDate(c.getDate()+30),r(c.toISOString().split("T")[0])}},[n,g]);const a=()=>{if(!T||!g){o.error("Bitte füllen Sie alle Pflichtfelder aus");return}f.mutate({ticketIds:[y],customerId:T,dueDate:new Date(g),hourlyRate:parseFloat(j),notes:h})};return e.jsx(de,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:82",open:n,onOpenChange:v,children:e.jsxs(xe,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:83",className:"max-w-2xl",children:[e.jsx(pe,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:84",children:e.jsx(he,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:85",children:"Rechnung aus Ticket erstellen"})}),e.jsxs("div",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:88",className:"space-y-4 mt-4",children:[m&&!("id"in m)&&e.jsxs("div",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:90",className:"p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:[e.jsxs("p",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:91",className:"text-sm text-yellow-600 dark:text-yellow-400",children:[e.jsx("strong",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:92",children:"Hinweis:"})," Kunde nicht in der Datenbank gefunden. Bitte wählen Sie einen bestehenden Kunden oder erstellen Sie zuerst einen neuen Kunden mit den Daten:"]}),e.jsxs("ul",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:95",className:"text-sm text-yellow-600 dark:text-yellow-400 mt-2 ml-4 list-disc",children:[e.jsxs("li",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:96",children:["Name: ",m.name]}),e.jsxs("li",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:97",children:["E-Mail: ",m.email]}),m.company&&e.jsxs("li",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:98",children:["Firma: ",m.company]})]})]}),e.jsxs("div",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:103",children:[e.jsx("label",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:104",className:"text-sm font-medium mb-2 block",children:"Kunde *"}),e.jsxs(A,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:105",value:T?.toString()||"",onValueChange:c=>p(parseInt(c)),children:[e.jsx(P,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:109",children:e.jsx(K,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:110",placeholder:"Kunde auswählen"})}),e.jsx(B,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:112",children:C?.map(c=>e.jsxs(u,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:114",value:c.id.toString(),children:[c.name," (",c.email,")"]},c.id))})]})]}),e.jsxs("div",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:122",children:[e.jsx("label",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:123",className:"text-sm font-medium mb-2 block",children:"Fälligkeitsdatum *"}),e.jsx(J,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:124",type:"date",value:g,onChange:c=>r(c.target.value)})]}),e.jsxs("div",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:127",children:[e.jsx("label",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:128",className:"text-sm font-medium mb-2 block",children:"Stundensatz (CHF)"}),e.jsx(J,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:129",type:"number",step:"0.01",value:j,onChange:c=>N(c.target.value)}),e.jsx("p",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:135",className:"text-xs text-muted-foreground mt-1",children:"Die Stunden werden automatisch basierend auf der Ticket-Priorität geschätzt"})]}),e.jsxs("div",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:140",children:[e.jsx("label",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:141",className:"text-sm font-medium mb-2 block",children:"Notizen"}),e.jsx("textarea",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:142",className:"w-full min-h-[80px] px-3 py-2 rounded-md border border-input bg-background",value:h,onChange:c=>w(c.target.value),placeholder:"Interne Notizen zur Rechnung..."})]}),e.jsxs("div",{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:150",className:"flex justify-end gap-2 pt-4",children:[e.jsx(k,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:151",variant:"outline",onClick:()=>v(!1),children:"Abbrechen"}),e.jsx(k,{"data-loc":"client/src/components/CreateInvoiceFromTicketDialog.tsx:154",onClick:a,disabled:f.isPending,children:f.isPending?"Erstelle...":"Rechnung erstellen"})]})]})]})})}function Me({value:n,onChange:v,placeholder:y,className:D}){const[T,p]=i.useState(!1),[g,r]=i.useState(""),[j,N]=i.useState(0),h=i.useRef(null),{data:w}=d.users.all.useQuery(),C=a=>{const c=a.target.value,s=a.target.selectionStart;v(c),N(s);const x=c.substring(0,s).match(/@(\w*)$/);x?(r(x[1]),p(!0)):(p(!1),r(""))},m=a=>{if(!h.current)return;const c=n.substring(0,j),s=n.substring(j),F=c.lastIndexOf("@"),x=c.substring(0,F)+`@${a} `+s;v(x),p(!1),r(""),setTimeout(()=>{if(h.current){const M=F+a.length+2;h.current.focus(),h.current.setSelectionRange(M,M)}},0)},f=w?.filter(a=>a.name?.toLowerCase().includes(g.toLowerCase()))||[];return e.jsxs("div",{"data-loc":"client/src/components/MentionTextarea.tsx:72",className:"relative",children:[e.jsx(ue,{"data-loc":"client/src/components/MentionTextarea.tsx:73",ref:h,value:n,onChange:C,placeholder:y,className:D,rows:4}),T&&f.length>0&&e.jsx("div",{"data-loc":"client/src/components/MentionTextarea.tsx:83",className:"absolute bottom-full left-0 mb-2 w-64 bg-black/95 border border-white/20 rounded-lg shadow-lg max-h-48 overflow-y-auto z-50",children:e.jsx("div",{"data-loc":"client/src/components/MentionTextarea.tsx:84",className:"p-2 space-y-1",children:f.slice(0,5).map(a=>e.jsx("button",{"data-loc":"client/src/components/MentionTextarea.tsx:86",onClick:()=>m(a.name||a.email||""),className:"w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsxs("div",{"data-loc":"client/src/components/MentionTextarea.tsx:91",className:"flex items-center gap-2",children:[e.jsx("div",{"data-loc":"client/src/components/MentionTextarea.tsx:92",className:"w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center text-primary text-sm font-medium",children:(a.name||a.email||"?")[0].toUpperCase()}),e.jsxs("div",{"data-loc":"client/src/components/MentionTextarea.tsx:95",children:[e.jsx("p",{"data-loc":"client/src/components/MentionTextarea.tsx:96",className:"text-sm font-medium text-white",children:a.name||a.email}),a.role&&e.jsx("p",{"data-loc":"client/src/components/MentionTextarea.tsx:98",className:"text-xs text-gray-400 capitalize",children:a.role})]})]})},a.id))})})]})}function et({ticketId:n,onClose:v}){const{user:y}=me(),[D,T]=i.useState(""),[p,g]=i.useState(!1),[r,j]=i.useState(null),[N,h]=i.useState(!1),[w,C]=i.useState(""),[m,f]=i.useState(!1),a=i.useRef(null),c=d.useUtils(),{data:s,isLoading:F}=d.tickets.byId.useQuery({id:n}),x=y?.role==="admin"||y?.role==="support",{data:M,isLoading:ee}=d.comments.getComments.useQuery({ticketId:n}),{data:R,isLoading:te}=d.comments.getAttachments.useQuery({ticketId:n}),{data:I,isLoading:$}=d.kb.all.useQuery({search:w},{enabled:N&&w.length>2}),{data:se}=d.users.all.useQuery(void 0,{enabled:x}),ce=se?.filter(t=>t.role==="admin"||t.role==="support"),G=d.tickets.assign.useMutation({onSuccess:()=>{o.success("Ticket zugewiesen"),c.tickets.byId.invalidate({id:n})},onError:t=>{o.error(t.message||"Fehler beim Zuweisen des Tickets")}}),L=d.tickets.update.useMutation({onSuccess:()=>{o.success("Ticket aktualisiert"),c.tickets.byId.invalidate({id:n}),c.tickets.all.invalidate()},onError:t=>{o.error(t.message||"Fehler beim Aktualisieren des Tickets")}}),E=d.comments.createComment.useMutation({onSuccess:()=>{o.success(p?"Private Notiz hinzugefügt":"Kommentar hinzugefügt"),T(""),g(!1),c.comments.getComments.invalidate({ticketId:n})},onError:t=>{o.error(t.message||"Fehler beim Hinzufügen des Kommentars")}}),Q=d.comments.uploadAttachment.useMutation({onSuccess:()=>{o.success("Datei hochgeladen"),j(null),a.current&&(a.current.value=""),c.comments.getAttachments.invalidate({ticketId:n})},onError:t=>{o.error(t.message||"Fehler beim Hochladen der Datei")}}),ae=()=>{if(!D.trim()){o.error("Bitte geben Sie einen Kommentar ein");return}E.mutate({ticketId:n,message:D,isInternal:p})},ne=t=>{const l=t.target.files?.[0];if(l){if(l.size>10*1024*1024){o.error("Datei ist zu groß (max. 10MB)");return}j(l)}},ie=async()=>{if(!r)return;const t=new FileReader;t.onload=async()=>{const l=t.result?.toString().split(",")[1];if(!l){o.error("Fehler beim Lesen der Datei");return}Q.mutate({ticketId:n,filename:r.name,fileData:l,mimeType:r.type})},t.readAsDataURL(r)},z=t=>new Date(t).toLocaleString("de-DE",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),_=t=>t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(1)+" MB",le=t=>{const l={open:"bg-blue-500/20 text-blue-400 border-blue-500/30",in_progress:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",resolved:"bg-green-500/20 text-green-400 border-green-500/30",closed:"bg-gray-500/20 text-gray-400 border-gray-500/30"};return l[t]||l.open},oe=t=>{const l={low:"bg-green-500/20 text-green-400 border-green-500/30",medium:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",high:"bg-orange-500/20 text-orange-400 border-orange-500/30",urgent:"bg-red-500/20 text-red-400 border-red-500/30"};return l[t]||l.medium},q=t=>({network:"Netzwerk",security:"Sicherheit",hardware:"Hardware",software:"Software",email:"E-Mail",other:"Sonstiges"})[t]||t,U=M?.filter(t=>x?!0:t.isInternal===0);return e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:212",className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:[e.jsx("div",{"data-loc":"client/src/components/TicketDetail.tsx:213",className:"w-full max-w-5xl my-8 max-h-[90vh] overflow-y-auto",children:e.jsxs(ge,{"data-loc":"client/src/components/TicketDetail.tsx:214",className:"bg-zinc-900 border-white/10",children:[e.jsx(ke,{"data-loc":"client/src/components/TicketDetail.tsx:215",className:"border-b border-white/10 sticky top-0 bg-zinc-900 z-20 shadow-lg",children:e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:216",className:"flex justify-between items-start",children:[e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:217",children:[e.jsxs(De,{"data-loc":"client/src/components/TicketDetail.tsx:218",className:"text-white text-2xl",children:["Ticket #",n]}),s&&e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:220",className:"text-sm text-gray-400 mt-1",children:s.subject})]}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:223",className:"flex gap-2",children:[x&&s&&s.status==="closed"&&e.jsxs(k,{"data-loc":"client/src/components/TicketDetail.tsx:225",variant:"outline",size:"sm",onClick:()=>f(!0),className:"border-primary/50 hover:bg-primary/10",children:[e.jsx(be,{"data-loc":"client/src/components/TicketDetail.tsx:231",className:"h-4 w-4 mr-2"}),"Rechnung erstellen"]}),e.jsx(k,{"data-loc":"client/src/components/TicketDetail.tsx:235",variant:"ghost",size:"sm",onClick:v,children:e.jsx(W,{"data-loc":"client/src/components/TicketDetail.tsx:236",className:"h-4 w-4"})})]})]})}),e.jsx(Te,{"data-loc":"client/src/components/TicketDetail.tsx:242",className:"p-6 space-y-6",children:F?e.jsx("div",{"data-loc":"client/src/components/TicketDetail.tsx:244",className:"flex justify-center py-12",children:e.jsx(S,{"data-loc":"client/src/components/TicketDetail.tsx:245",className:"h-8 w-8 animate-spin text-primary"})}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:250",className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:251",className:"space-y-4",children:[e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:252",children:[e.jsxs("h3",{"data-loc":"client/src/components/TicketDetail.tsx:253",className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx(ve,{"data-loc":"client/src/components/TicketDetail.tsx:254",className:"h-4 w-4"}),"Kunde"]}),e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:257",className:"text-white",children:s.customerName}),e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:258",className:"text-sm text-gray-400",children:s.customerEmail}),s.company&&e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:259",className:"text-sm text-gray-400",children:s.company})]}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:262",children:[e.jsxs("h3",{"data-loc":"client/src/components/TicketDetail.tsx:263",className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx(Ne,{"data-loc":"client/src/components/TicketDetail.tsx:264",className:"h-4 w-4"}),"Zeitstempel"]}),e.jsxs("p",{"data-loc":"client/src/components/TicketDetail.tsx:267",className:"text-sm text-white",children:["Erstellt: ",z(s.createdAt)]}),s.resolvedAt&&e.jsxs("p",{"data-loc":"client/src/components/TicketDetail.tsx:269",className:"text-sm text-white",children:["Gelöst: ",z(s.resolvedAt)]})]})]}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:274",className:"space-y-4",children:[x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:277",children:[e.jsxs("h3",{"data-loc":"client/src/components/TicketDetail.tsx:278",className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx(Y,{"data-loc":"client/src/components/TicketDetail.tsx:279",className:"h-4 w-4"}),"Status"]}),e.jsxs(A,{"data-loc":"client/src/components/TicketDetail.tsx:282",value:s.status,onValueChange:t=>{L.mutate({id:s.id,status:t})},disabled:L.isPending,children:[e.jsx(P,{"data-loc":"client/src/components/TicketDetail.tsx:292",className:"bg-white/5 border-white/10 text-white",children:e.jsx(K,{"data-loc":"client/src/components/TicketDetail.tsx:293"})}),e.jsxs(B,{"data-loc":"client/src/components/TicketDetail.tsx:295",children:[e.jsx(u,{"data-loc":"client/src/components/TicketDetail.tsx:296",value:"open",children:"Offen"}),e.jsx(u,{"data-loc":"client/src/components/TicketDetail.tsx:297",value:"in_progress",children:"In Bearbeitung"}),e.jsx(u,{"data-loc":"client/src/components/TicketDetail.tsx:298",value:"resolved",children:"Gelöst"}),e.jsx(u,{"data-loc":"client/src/components/TicketDetail.tsx:299",value:"closed",children:"Geschlossen"})]})]})]}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:303",children:[e.jsxs("h3",{"data-loc":"client/src/components/TicketDetail.tsx:304",className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx(Z,{"data-loc":"client/src/components/TicketDetail.tsx:305",className:"h-4 w-4"}),"Priorität"]}),e.jsxs(A,{"data-loc":"client/src/components/TicketDetail.tsx:308",value:s.priority,onValueChange:t=>{L.mutate({id:s.id,priority:t})},disabled:L.isPending,children:[e.jsx(P,{"data-loc":"client/src/components/TicketDetail.tsx:318",className:"bg-white/5 border-white/10 text-white",children:e.jsx(K,{"data-loc":"client/src/components/TicketDetail.tsx:319"})}),e.jsxs(B,{"data-loc":"client/src/components/TicketDetail.tsx:321",children:[e.jsx(u,{"data-loc":"client/src/components/TicketDetail.tsx:322",value:"low",children:"Niedrig"}),e.jsx(u,{"data-loc":"client/src/components/TicketDetail.tsx:323",value:"medium",children:"Mittel"}),e.jsx(u,{"data-loc":"client/src/components/TicketDetail.tsx:324",value:"high",children:"Hoch"}),e.jsx(u,{"data-loc":"client/src/components/TicketDetail.tsx:325",value:"urgent",children:"Dringend"})]})]})]}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:329",children:[e.jsx("h3",{"data-loc":"client/src/components/TicketDetail.tsx:330",className:"text-sm font-medium text-gray-400 mb-2",children:"Kategorie"}),e.jsx(b,{"data-loc":"client/src/components/TicketDetail.tsx:331",className:"bg-purple-500/20 text-purple-400 border-purple-500/30",children:q(s.category)})]})]}):e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:337",children:[e.jsxs("h3",{"data-loc":"client/src/components/TicketDetail.tsx:338",className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx(Y,{"data-loc":"client/src/components/TicketDetail.tsx:339",className:"h-4 w-4"}),"Status & Priorität"]}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:342",className:"flex flex-wrap gap-2",children:[e.jsx(b,{"data-loc":"client/src/components/TicketDetail.tsx:343",className:le(s.status),children:s.status==="in_progress"?"In Bearbeitung":s.status==="open"?"Offen":s.status==="resolved"?"Gelöst":"Geschlossen"}),e.jsx(b,{"data-loc":"client/src/components/TicketDetail.tsx:346",className:oe(s.priority),children:s.priority}),e.jsx(b,{"data-loc":"client/src/components/TicketDetail.tsx:349",className:"bg-purple-500/20 text-purple-400 border-purple-500/30",children:q(s.category)})]})]}),s.slaDueDate&&s.status!=="resolved"&&s.status!=="closed"&&e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:357",children:[e.jsxs("h3",{"data-loc":"client/src/components/TicketDetail.tsx:358",className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx(Z,{"data-loc":"client/src/components/TicketDetail.tsx:359",className:"h-4 w-4"}),"SLA Status"]}),e.jsx(b,{"data-loc":"client/src/components/TicketDetail.tsx:362",className:new Date(s.slaDueDate)<new Date?"bg-red-500/20 text-red-400 border-red-500/30":"bg-green-500/20 text-green-400 border-green-500/30",children:new Date(s.slaDueDate)<new Date?"Überfällig":`Fällig: ${z(s.slaDueDate)}`}),s.escalationLevel&&s.escalationLevel>0&&e.jsxs(b,{"data-loc":"client/src/components/TicketDetail.tsx:366",className:"bg-orange-500/20 text-orange-400 border-orange-500/30 ml-2",children:["Eskalation Level ",s.escalationLevel]})]}),x&&e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:374",children:[e.jsxs("h3",{"data-loc":"client/src/components/TicketDetail.tsx:375",className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx(Ie,{"data-loc":"client/src/components/TicketDetail.tsx:376",className:"h-4 w-4"}),"Zugewiesen an"]}),e.jsxs(A,{"data-loc":"client/src/components/TicketDetail.tsx:379",value:s.assignedTo?.toString()||"unassigned",onValueChange:t=>{const l=t==="unassigned"?null:parseInt(t);G.mutate({ticketId:s.id,assignedTo:l})},disabled:G.isPending,children:[e.jsx(P,{"data-loc":"client/src/components/TicketDetail.tsx:390",className:"bg-white/5 border-white/10 text-white",children:e.jsx(K,{"data-loc":"client/src/components/TicketDetail.tsx:391"})}),e.jsxs(B,{"data-loc":"client/src/components/TicketDetail.tsx:393",children:[e.jsx(u,{"data-loc":"client/src/components/TicketDetail.tsx:394",value:"unassigned",children:"Nicht zugewiesen"}),ce?.map(t=>e.jsx(u,{"data-loc":"client/src/components/TicketDetail.tsx:396",value:t.id.toString(),children:t.name||t.email},t.id))]})]})]})]})]}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:408",children:[e.jsxs("h3",{"data-loc":"client/src/components/TicketDetail.tsx:409",className:"text-lg font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(X,{"data-loc":"client/src/components/TicketDetail.tsx:410",className:"h-5 w-5 text-primary"}),"Ursprüngliche Nachricht"]}),e.jsx("div",{"data-loc":"client/src/components/TicketDetail.tsx:413",className:"p-4 bg-white/5 rounded-lg border border-white/10",children:e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:414",className:"text-white whitespace-pre-wrap",children:s.message})})]}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:419",children:[e.jsxs("h3",{"data-loc":"client/src/components/TicketDetail.tsx:420",className:"text-lg font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(we,{"data-loc":"client/src/components/TicketDetail.tsx:421",className:"h-5 w-5 text-primary"}),"Anhänge"]}),te?e.jsx("div",{"data-loc":"client/src/components/TicketDetail.tsx:426",className:"flex justify-center py-4",children:e.jsx(S,{"data-loc":"client/src/components/TicketDetail.tsx:427",className:"h-6 w-6 animate-spin text-primary"})}):R&&R.length>0?e.jsx("div",{"data-loc":"client/src/components/TicketDetail.tsx:430",className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:R.map(t=>e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:432",className:"flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/10",children:[e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:436",className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx(O,{"data-loc":"client/src/components/TicketDetail.tsx:437",className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:438",className:"flex-1 min-w-0",children:[e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:439",className:"text-sm text-white truncate",children:t.filename}),e.jsxs("p",{"data-loc":"client/src/components/TicketDetail.tsx:440",className:"text-xs text-gray-400",children:[_(t.fileSize)," • ",z(t.createdAt)]})]})]}),e.jsx(k,{"data-loc":"client/src/components/TicketDetail.tsx:445",variant:"ghost",size:"sm",asChild:!0,className:"flex-shrink-0",children:e.jsx("a",{"data-loc":"client/src/components/TicketDetail.tsx:451",href:t.fileUrl,target:"_blank",rel:"noopener noreferrer",children:e.jsx(ye,{"data-loc":"client/src/components/TicketDetail.tsx:452",className:"h-4 w-4"})})})]},t.id))}):e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:459",className:"text-sm text-gray-400 mb-4",children:"Keine Anhänge vorhanden"}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:463",className:"space-y-3",children:[e.jsx("input",{"data-loc":"client/src/components/TicketDetail.tsx:464",ref:a,type:"file",onChange:ne,className:"hidden",accept:"image/*,.pdf,.doc,.docx,.txt,.log"}),r?e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:472",className:"flex items-center gap-3 p-3 bg-white/5 rounded-lg border border-white/10",children:[e.jsx(O,{"data-loc":"client/src/components/TicketDetail.tsx:473",className:"h-4 w-4 text-primary"}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:474",className:"flex-1",children:[e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:475",className:"text-sm text-white",children:r.name}),e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:476",className:"text-xs text-gray-400",children:_(r.size)})]}),e.jsx(k,{"data-loc":"client/src/components/TicketDetail.tsx:478",size:"sm",onClick:ie,disabled:Q.isPending,className:"bg-primary hover:bg-primary/90",children:Q.isPending?e.jsx(S,{"data-loc":"client/src/components/TicketDetail.tsx:485",className:"h-4 w-4 animate-spin"}):"Hochladen"}),e.jsx(k,{"data-loc":"client/src/components/TicketDetail.tsx:490",size:"sm",variant:"ghost",onClick:()=>{j(null),a.current&&(a.current.value="")},children:e.jsx(W,{"data-loc":"client/src/components/TicketDetail.tsx:500",className:"h-4 w-4"})})]}):e.jsxs(k,{"data-loc":"client/src/components/TicketDetail.tsx:504",variant:"outline",onClick:()=>a.current?.click(),className:"w-full border-white/20 bg-white/5 hover:bg-white/10",children:[e.jsx(O,{"data-loc":"client/src/components/TicketDetail.tsx:509",className:"h-4 w-4 mr-2"}),"Datei anhängen"]})]})]}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:517",children:[e.jsxs("h3",{"data-loc":"client/src/components/TicketDetail.tsx:518",className:"text-lg font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(X,{"data-loc":"client/src/components/TicketDetail.tsx:519",className:"h-5 w-5 text-primary"}),"Nachrichtenverlauf"]}),ee?e.jsx("div",{"data-loc":"client/src/components/TicketDetail.tsx:524",className:"flex justify-center py-4",children:e.jsx(S,{"data-loc":"client/src/components/TicketDetail.tsx:525",className:"h-6 w-6 animate-spin text-primary"})}):U&&U.length>0?e.jsx("div",{"data-loc":"client/src/components/TicketDetail.tsx:528",className:"space-y-3 mb-4",children:U.map(t=>e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:530",className:`p-4 rounded-lg border ${t.isInternal===1?"bg-orange-500/10 border-orange-500/30":"bg-white/5 border-white/10"}`,children:[e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:538",className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:539",className:"flex items-center gap-2",children:[e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:540",className:"text-sm font-medium text-white",children:t.userName||"Unbekannt"}),t.isInternal===1&&x&&e.jsxs(b,{"data-loc":"client/src/components/TicketDetail.tsx:544",className:"bg-orange-500/20 text-orange-400 border-orange-500/30 text-xs",children:[e.jsx(H,{"data-loc":"client/src/components/TicketDetail.tsx:545",className:"h-3 w-3 mr-1"}),"Private Notiz"]})]}),e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:550",className:"text-xs text-gray-400",children:z(t.createdAt)})]}),e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:552",className:"text-white whitespace-pre-wrap",children:t.message})]},t.id))}):e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:557",className:"text-sm text-gray-400 mb-4",children:"Keine Kommentare vorhanden"}),x&&e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:562",className:"mb-4",children:[e.jsxs(k,{"data-loc":"client/src/components/TicketDetail.tsx:563",variant:"outline",onClick:()=>h(!N),className:"w-full border-white/10 text-white hover:bg-white/10",children:[e.jsx(Ce,{"data-loc":"client/src/components/TicketDetail.tsx:568",className:"h-4 w-4 mr-2"}),N?"KB-Suche schließen":"Wissensdatenbank durchsuchen"]}),N&&e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:572",className:"mt-3 space-y-3",children:[e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:573",className:"relative",children:[e.jsx(Se,{"data-loc":"client/src/components/TicketDetail.tsx:574",className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{"data-loc":"client/src/components/TicketDetail.tsx:575",type:"text",value:w,onChange:t=>C(t.target.value),placeholder:"Suche nach Lösungen...",className:"w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary"})]}),$&&e.jsx("div",{"data-loc":"client/src/components/TicketDetail.tsx:584",className:"flex justify-center py-4",children:e.jsx(S,{"data-loc":"client/src/components/TicketDetail.tsx:585",className:"h-6 w-6 animate-spin text-primary"})}),I&&I.length>0&&e.jsx("div",{"data-loc":"client/src/components/TicketDetail.tsx:589",className:"max-h-[300px] overflow-y-auto space-y-2",children:I.map(t=>e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:591",className:"p-3 bg-white/5 rounded-lg border border-white/10 hover:border-primary/50 transition-colors cursor-pointer",onClick:()=>{T(D+(D?`

`:"")+t.content),h(!1),C(""),o.success("KB-Artikel eingefügt")},children:[e.jsx("h4",{"data-loc":"client/src/components/TicketDetail.tsx:601",className:"text-sm font-medium text-white mb-1",children:t.title}),e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:602",className:"text-xs text-gray-400 line-clamp-2",children:t.content}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:603",className:"flex gap-2 mt-2",children:[e.jsx(b,{"data-loc":"client/src/components/TicketDetail.tsx:604",variant:"secondary",className:"text-xs",children:t.category}),t.visibility==="internal"&&e.jsxs(b,{"data-loc":"client/src/components/TicketDetail.tsx:606",variant:"outline",className:"text-xs",children:[e.jsx(H,{"data-loc":"client/src/components/TicketDetail.tsx:607",className:"h-3 w-3 mr-1"}),"Intern"]})]})]},t.id))}),w.length>2&&!$&&I&&I.length===0&&e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:617",className:"text-sm text-gray-400 text-center py-4",children:"Keine Artikel gefunden"})]})]}),e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:625",className:"space-y-3",children:[e.jsx(Me,{"data-loc":"client/src/components/TicketDetail.tsx:626",value:D,onChange:T,placeholder:"Kommentar hinzufügen... Verwenden Sie @Name für Erwähnungen",className:"bg-white/5 border-white/10 text-white min-h-[100px]"}),x&&e.jsxs("div",{"data-loc":"client/src/components/TicketDetail.tsx:633",className:"flex items-center space-x-2 p-3 bg-white/5 rounded-lg border border-white/10",children:[e.jsx(je,{"data-loc":"client/src/components/TicketDetail.tsx:634",id:"private-note",checked:p,onCheckedChange:t=>g(t),className:"border-white/30"}),e.jsxs(fe,{"data-loc":"client/src/components/TicketDetail.tsx:640",htmlFor:"private-note",className:"text-sm text-gray-300 cursor-pointer flex items-center gap-2 font-medium",children:[e.jsx(H,{"data-loc":"client/src/components/TicketDetail.tsx:644",className:"h-4 w-4"}),"Als private Notiz markieren (nur für Mitarbeitende sichtbar)"]})]}),e.jsxs(k,{"data-loc":"client/src/components/TicketDetail.tsx:649",onClick:ae,disabled:E.isPending,className:"w-full bg-primary hover:bg-primary/90",children:[E.isPending?e.jsx(S,{"data-loc":"client/src/components/TicketDetail.tsx:655",className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Fe,{"data-loc":"client/src/components/TicketDetail.tsx:657",className:"h-4 w-4 mr-2"}),p?"Private Notiz hinzufügen":"Kommentar senden"]})]})]})]}):e.jsx("p",{"data-loc":"client/src/components/TicketDetail.tsx:665",className:"text-center text-gray-400 py-12",children:"Ticket nicht gefunden"})})]})}),e.jsx(ze,{"data-loc":"client/src/components/TicketDetail.tsx:672",open:m,onOpenChange:f,ticketId:n})]})}export{et as T};
