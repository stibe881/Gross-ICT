import{x as e,J as A,j as r,N as o,A as i}from"./index-BN9GAmQT.js";import{B as N}from"./button-B7XicF_D.js";import{I as h}from"./input-DAxyQcQ6.js";import{L as u}from"./label-WV9rmlgK.js";import{C as I,a as B,b as E,c as k,d as P}from"./card-DDCG5iAJ.js";import{L as v}from"./loader-circle-ClqFH6Ch.js";import"./index-Ci_qB1WW.js";import"./dialog-BFxkyGdG.js";import"./index-DkLA8Hun.js";import"./index-BxbciWQS.js";const R=({className:a})=>e.jsxs("svg",{"data-loc":"client/src/components/icons/MicrosoftIcon.tsx:9",className:a,viewBox:"0 0 23 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{"data-loc":"client/src/components/icons/MicrosoftIcon.tsx:15",x:"0",y:"0",width:"10",height:"10",fill:"#F25022"}),e.jsx("rect",{"data-loc":"client/src/components/icons/MicrosoftIcon.tsx:16",x:"12",y:"0",width:"10",height:"10",fill:"#7FBA00"}),e.jsx("rect",{"data-loc":"client/src/components/icons/MicrosoftIcon.tsx:17",x:"0",y:"12",width:"10",height:"10",fill:"#00A4EF"}),e.jsx("rect",{"data-loc":"client/src/components/icons/MicrosoftIcon.tsx:18",x:"12",y:"12",width:"10",height:"10",fill:"#FFB900"})]});function Q(){const[,a]=A(),[c,y]=r.useState(""),[n,d]=r.useState(""),[s,p]=r.useState(!1),[g,x]=r.useState(""),f=o.useUtils(),{data:l}=o.auth.me.useQuery();r.useEffect(()=>{l&&(l.role==="admin"||l.role==="support"?a("/admin"):a("/dashboard"))},[l,a]);const w=o.auth.login.useMutation({onSuccess:async()=>{await f.auth.me.invalidate();const t=await f.auth.me.fetch();i.success("Login erfolgreich!"),t&&(t.role==="admin"||t.role==="support"||t.role==="accounting"?a("/admin"):a("/dashboard"))},onError:t=>{i.error(t.message||"Login fehlgeschlagen")}}),L=o.auth.register.useMutation({onSuccess:()=>{i.success("Account erstellt! Bitte melden Sie sich an."),p(!1),x(""),d("")},onError:t=>{i.error(t.message||"Registrierung fehlgeschlagen")}}),M=t=>{if(t.preventDefault(),s){if(!g||!c||!n){i.error("Bitte füllen Sie alle Felder aus");return}L.mutate({email:c,password:n,name:g})}else{if(!c||!n){i.error("Bitte füllen Sie alle Felder aus");return}w.mutate({email:c,password:n})}},j=w.isPending||L.isPending,S=()=>{const[t,b]=r.useState(!1),F=o.microsoftOAuth.getAuthUrl.useMutation({onSuccess:m=>{window.location.href=m.authUrl},onError:m=>{b(!1),i.error(m.message||"Microsoft-Login fehlgeschlagen")}}),C=()=>{b(!0),F.mutate({returnUrl:window.location.pathname})};return e.jsx(N,{"data-loc":"client/src/pages/Login.tsx:106",type:"button",variant:"outline",className:"w-full bg-white/5 border-white/10 hover:bg-white/10 text-white",onClick:C,disabled:t,children:t?e.jsxs(e.Fragment,{children:[e.jsx(v,{"data-loc":"client/src/pages/Login.tsx:115",className:"mr-2 h-4 w-4 animate-spin"}),"Weiterleitung..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{"data-loc":"client/src/pages/Login.tsx:120",className:"mr-2 h-5 w-5"}),"Mit Microsoft anmelden"]})})};return e.jsx("div",{"data-loc":"client/src/pages/Login.tsx:129",className:"min-h-screen flex items-center justify-center bg-black px-4",children:e.jsxs(I,{"data-loc":"client/src/pages/Login.tsx:130",className:"w-full max-w-md bg-white/5 border-white/10 backdrop-blur-xl",children:[e.jsxs(B,{"data-loc":"client/src/pages/Login.tsx:131",children:[e.jsx(E,{"data-loc":"client/src/pages/Login.tsx:132",className:"text-2xl font-bold text-white",children:s?"Account erstellen":"Anmelden"}),e.jsx(k,{"data-loc":"client/src/pages/Login.tsx:135",className:"text-gray-400",children:s?"Erstellen Sie ein Konto für das Support-Portal":"Melden Sie sich an, um Ihre Tickets zu verwalten"})]}),e.jsx(P,{"data-loc":"client/src/pages/Login.tsx:141",children:e.jsxs("form",{"data-loc":"client/src/pages/Login.tsx:142",onSubmit:M,className:"space-y-4",children:[s&&e.jsxs("div",{"data-loc":"client/src/pages/Login.tsx:144",className:"space-y-2",children:[e.jsx(u,{"data-loc":"client/src/pages/Login.tsx:145",htmlFor:"name",className:"text-white",children:"Name"}),e.jsx(h,{"data-loc":"client/src/pages/Login.tsx:146",id:"name",type:"text",value:g,onChange:t=>x(t.target.value),placeholder:"Ihr Name",required:!0,className:"bg-white/10 border-white/20 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{"data-loc":"client/src/pages/Login.tsx:158",className:"space-y-2",children:[e.jsx(u,{"data-loc":"client/src/pages/Login.tsx:159",htmlFor:"email",className:"text-white",children:"E-Mail"}),e.jsx(h,{"data-loc":"client/src/pages/Login.tsx:160",id:"email",type:"email",value:c,onChange:t=>y(t.target.value),placeholder:"ihre@email.com",required:!0,className:"bg-white/10 border-white/20 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{"data-loc":"client/src/pages/Login.tsx:171",className:"space-y-2",children:[e.jsx(u,{"data-loc":"client/src/pages/Login.tsx:172",htmlFor:"password",className:"text-white",children:"Passwort"}),e.jsx(h,{"data-loc":"client/src/pages/Login.tsx:173",id:"password",type:"password",value:n,onChange:t=>d(t.target.value),placeholder:"••••••••",required:!0,className:"bg-white/10 border-white/20 text-white placeholder:text-gray-500"})]}),e.jsx(N,{"data-loc":"client/src/pages/Login.tsx:184",type:"submit",className:"w-full bg-primary hover:bg-primary/90",disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(v,{"data-loc":"client/src/pages/Login.tsx:191",className:"mr-2 h-4 w-4 animate-spin"}),s?"Wird erstellt...":"Wird angemeldet..."]}):e.jsx(e.Fragment,{children:s?"Account erstellen":"Anmelden"})}),!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{"data-loc":"client/src/pages/Login.tsx:201",className:"relative",children:[e.jsx("div",{"data-loc":"client/src/pages/Login.tsx:202",className:"absolute inset-0 flex items-center",children:e.jsx("span",{"data-loc":"client/src/pages/Login.tsx:203",className:"w-full border-t border-white/10"})}),e.jsx("div",{"data-loc":"client/src/pages/Login.tsx:205",className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{"data-loc":"client/src/pages/Login.tsx:206",className:"bg-black px-2 text-gray-400",children:"Oder"})})]}),e.jsx(S,{"data-loc":"client/src/pages/Login.tsx:210"})]}),e.jsx("div",{"data-loc":"client/src/pages/Login.tsx:214",className:"text-center",children:e.jsx("button",{"data-loc":"client/src/pages/Login.tsx:215",type:"button",onClick:()=>{p(!s),x(""),d("")},className:"text-sm text-primary hover:underline",children:s?"Bereits ein Konto? Anmelden":"Noch kein Konto? Registrieren"})})]})})]})})}export{Q as default};
