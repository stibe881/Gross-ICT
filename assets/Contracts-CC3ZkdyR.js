import{c as lt,j as o,N as C,A as m,x as t,J as qt}from"./index-BN9GAmQT.js";import{B as d}from"./button-B7XicF_D.js";import{T as Bt,a as Kt,b as gt,c as ht}from"./tabs-BqpNVkZh.js";import{I as j}from"./input-DAxyQcQ6.js";import{C as W,d as ut}from"./card-DDCG5iAJ.js";import{B as ot}from"./badge-DuBy3M6P.js";import{D as et,a as at,b as nt,c as st,e as Qt}from"./dialog-BFxkyGdG.js";import{L as i}from"./label-WV9rmlgK.js";import{T as ct}from"./textarea-CUpb7IQY.js";import{S as K,a as Q,b as $,c as H,d as l}from"./select-lpC4X7iX.js";import{P as Z}from"./plus-Bs9J4-Yt.js";import{T as mt}from"./trash-2-BGEcaC5X.js";import{S as bt}from"./search-DYS7RNfR.js";import{F as rt}from"./file-text-zOWEdpec.js";import{E as Dt}from"./eye-DH5-FCbl.js";import{S as $t}from"./square-pen-CPfJwZSi.js";import{C as jt}from"./calendar-lP7qctBn.js";import{C as vt}from"./clock-C0SPg0PF.js";import{D as Ht}from"./dollar-sign-BhOElyIN.js";import{U as ft}from"./user-DNKQZcJU.js";import{C as Nt}from"./circle-check-CegIR20y.js";import{D as Ft}from"./download-_y-9cJJ1.js";import{A as Ot}from"./arrow-left-DYl8JD6p.js";import{C as Ut}from"./chart-column-8Hy86w9_.js";import"./index-Ci_qB1WW.js";import"./index-DE5s7y_t.js";import"./index-DYYK5dbJ.js";import"./index-DkLA8Hun.js";import"./index-BxbciWQS.js";import"./index-FM6g0UGI.js";import"./chevron-up-CGjsbtlF.js";import"./check-B0XS7teL.js";const Mt=lt("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);const Tt=lt("FilePenLine",[["path",{d:"m18 5-2.414-2.414A2 2 0 0 0 14.172 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2",key:"142zxg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]]);const wt=lt("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);const _t=lt("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);const Gt=lt("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);function yt({templateId:x,onSuccess:k,onCancel:D}){const[f,g]=o.useState(""),[u,F]=o.useState(""),[N,p]=o.useState("service"),[V,y]=o.useState("monthly"),[I,P]=o.useState("12"),[M,z]=o.useState("30"),[R,E]=o.useState("0"),[a,w]=o.useState("30"),[O,U]=o.useState(""),[T,S]=o.useState([{description:"",defaultQuantity:"1",defaultUnit:"StÃ¼ck",defaultUnitPrice:"0",defaultVatRate:"8.10",defaultDiscount:"0"}]),{data:L}=C.contractTemplates.getById.useQuery({id:x},{enabled:!!x});o.useEffect(()=>{if(L){const{template:c,items:e}=L;g(c.name),F(c.description||""),p(c.contractType),y(c.defaultBillingInterval),P(c.defaultDurationMonths.toString()),z(c.defaultPaymentTermsDays.toString()),E(c.defaultAutoRenew.toString()),w(c.defaultRenewalNoticeDays.toString()),U(c.defaultTerms||""),S(e.map(r=>({description:r.description,defaultQuantity:r.defaultQuantity,defaultUnit:r.defaultUnit,defaultUnitPrice:r.defaultUnitPrice,defaultVatRate:r.defaultVatRate,defaultDiscount:r.defaultDiscount})))}},[L]);const s=C.contractTemplates.create.useMutation({onSuccess:()=>{m.success("Vorlage erstellt"),k()},onError:c=>{m.error(`Fehler: ${c.message}`)}}),b=C.contractTemplates.update.useMutation({onSuccess:()=>{m.success("Vorlage aktualisiert"),k()},onError:c=>{m.error(`Fehler: ${c.message}`)}}),J=c=>{if(c.preventDefault(),!f.trim()){m.error("Bitte geben Sie einen Namen ein");return}if(T.length===0){m.error("Bitte fÃ¼gen Sie mindestens eine Position hinzu");return}const e={name:f.trim(),description:u.trim()||void 0,contractType:N,defaultBillingInterval:V,defaultDurationMonths:parseInt(I),defaultPaymentTermsDays:parseInt(M),defaultAutoRenew:parseInt(R),defaultRenewalNoticeDays:parseInt(a),defaultTerms:O.trim()||void 0,items:T};x?b.mutate({id:x,...e}):s.mutate(e)},_=()=>{S([...T,{description:"",defaultQuantity:"1",defaultUnit:"StÃ¼ck",defaultUnitPrice:"0",defaultVatRate:"8.10",defaultDiscount:"0"}])},X=c=>{S(T.filter((e,r)=>r!==c))},q=(c,e,r)=>{const Y=[...T];Y[c]={...Y[c],[e]:r},S(Y)};return t.jsxs("form",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:166",onSubmit:J,className:"space-y-6",children:[t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:168",className:"space-y-4",children:[t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:169",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:170",htmlFor:"name",children:"Vorlagenname *"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:171",id:"name",value:f,onChange:c=>g(c.target.value),placeholder:"z.B. Standard IT-Support",required:!0})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:180",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:181",htmlFor:"description",children:"Beschreibung"}),t.jsx(ct,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:182",id:"description",value:u,onChange:c=>F(c.target.value),placeholder:"Optionale Beschreibung der Vorlage",rows:2})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:191",className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:192",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:193",htmlFor:"contractType",children:"Vertragstyp"}),t.jsxs(K,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:194",value:N,onValueChange:p,children:[t.jsx(Q,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:195",children:t.jsx($,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:196"})}),t.jsxs(H,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:198",children:[t.jsx(l,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:199",value:"service",children:"Service"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:200",value:"license",children:"Lizenz"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:201",value:"support",children:"Support"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:202",value:"hosting",children:"Hosting"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:203",value:"maintenance",children:"Wartung"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:204",value:"other",children:"Sonstiges"})]})]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:209",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:210",htmlFor:"billingInterval",children:"Abrechnungsintervall"}),t.jsxs(K,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:211",value:V,onValueChange:y,children:[t.jsx(Q,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:212",children:t.jsx($,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:213"})}),t.jsxs(H,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:215",children:[t.jsx(l,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:216",value:"monthly",children:"Monatlich"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:217",value:"quarterly",children:"Quartalsweise"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:218",value:"yearly",children:"JÃ¤hrlich"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:219",value:"one_time",children:"Einmalig"})]})]})]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:225",className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:226",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:227",htmlFor:"durationMonths",children:"Laufzeit (Monate)"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:228",id:"durationMonths",type:"number",value:I,onChange:c=>P(c.target.value),min:"1"})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:237",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:238",htmlFor:"paymentTermsDays",children:"Zahlungsziel (Tage)"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:239",id:"paymentTermsDays",type:"number",value:M,onChange:c=>z(c.target.value),min:"0"})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:248",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:249",htmlFor:"renewalNoticeDays",children:"KÃ¼ndigungsfrist (Tage)"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:250",id:"renewalNoticeDays",type:"number",value:a,onChange:c=>w(c.target.value),min:"0"})]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:260",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:261",htmlFor:"autoRenew",children:"Automatische VerlÃ¤ngerung"}),t.jsxs(K,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:262",value:R,onValueChange:E,children:[t.jsx(Q,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:263",children:t.jsx($,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:264"})}),t.jsxs(H,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:266",children:[t.jsx(l,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:267",value:"0",children:"Nein"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:268",value:"1",children:"Ja"})]})]})]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:275",className:"space-y-4",children:[t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:276",className:"flex items-center justify-between",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:277",children:"Standard-Positionen *"}),t.jsxs(d,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:278",type:"button",onClick:_,size:"sm",variant:"outline",children:[t.jsx(Z,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:279",className:"w-4 h-4 mr-2"}),"Position hinzufÃ¼gen"]})]}),T.map((c,e)=>t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:285",className:"p-4 border rounded-lg space-y-3",children:[t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:286",className:"flex items-start justify-between",children:[t.jsxs(i,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:287",children:["Position ",e+1]}),T.length>1&&t.jsx(d,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:289",type:"button",onClick:()=>X(e),size:"sm",variant:"ghost",children:t.jsx(mt,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:295",className:"w-4 h-4 text-red-500"})})]}),t.jsx("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:300",children:t.jsx(j,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:301",value:c.description,onChange:r=>q(e,"description",r.target.value),placeholder:"Beschreibung",required:!0})}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:309",className:"grid grid-cols-3 gap-2",children:[t.jsx(j,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:310",type:"number",step:"0.01",value:c.defaultQuantity,onChange:r=>q(e,"defaultQuantity",r.target.value),placeholder:"Menge",required:!0}),t.jsx(j,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:318",value:c.defaultUnit,onChange:r=>q(e,"defaultUnit",r.target.value),placeholder:"Einheit",required:!0}),t.jsx(j,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:324",type:"number",step:"0.01",value:c.defaultUnitPrice,onChange:r=>q(e,"defaultUnitPrice",r.target.value),placeholder:"Preis",required:!0})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:334",className:"grid grid-cols-2 gap-2",children:[t.jsx(j,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:335",type:"number",step:"0.01",value:c.defaultVatRate,onChange:r=>q(e,"defaultVatRate",r.target.value),placeholder:"MwSt. %",required:!0}),t.jsx(j,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:343",type:"number",step:"0.01",value:c.defaultDiscount,onChange:r=>q(e,"defaultDiscount",r.target.value),placeholder:"Rabatt %",required:!0})]})]},e))]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:357",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:358",htmlFor:"terms",children:"Standard-Vertragsbedingungen"}),t.jsx(ct,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:359",id:"terms",value:O,onChange:c=>U(c.target.value),placeholder:"Optionale Standard-Bedingungen fÃ¼r VertrÃ¤ge aus dieser Vorlage",rows:4})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:369",className:"flex justify-end gap-3",children:[t.jsx(d,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:370",type:"button",onClick:D,variant:"outline",children:"Abbrechen"}),t.jsx(d,{"data-loc":"client/src/components/CreateContractTemplateForm.tsx:373",type:"submit",disabled:s.isPending||b.isPending,children:x?"Aktualisieren":"Erstellen"})]})]})}function Wt(){const[x,k]=o.useState(""),[D,f]=o.useState(!1),[g,u]=o.useState(null),[F,N]=o.useState(null),{data:p,isLoading:V,refetch:y}=C.contractTemplates.getAll.useQuery({search:x||void 0}),I=C.contractTemplates.toggleActive.useMutation({onSuccess:()=>{m.success("Status aktualisiert"),y()},onError:a=>{m.error(`Fehler: ${a.message}`)}}),P=C.contractTemplates.delete.useMutation({onSuccess:()=>{m.success("Vorlage gelÃ¶scht"),y()},onError:a=>{m.error(`Fehler: ${a.message}`)}}),M=(a,w)=>{I.mutate({id:a,isActive:w===1?0:1})},z=(a,w)=>{confirm(`MÃ¶chten Sie die Vorlage "${w}" wirklich lÃ¶schen?`)&&P.mutate({id:a})},R=a=>({service:"Service",license:"Lizenz",support:"Support",hosting:"Hosting",maintenance:"Wartung",other:"Sonstiges"})[a]||a,E=a=>({monthly:"Monatlich",quarterly:"Quartalsweise",yearly:"JÃ¤hrlich",one_time:"Einmalig"})[a]||a;return t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:75",className:"space-y-6",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:76",className:"flex items-center justify-between",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:77",children:[t.jsx("h2",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:78",className:"text-2xl font-bold",children:"Vertragsvorlagen"}),t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:79",className:"text-muted-foreground mt-1",children:"Erstellen Sie wiederverwendbare Vorlagen fÃ¼r hÃ¤ufige Vertragsarten"})]}),t.jsxs(d,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:83",onClick:()=>f(!0),className:"gap-2",children:[t.jsx(Z,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:84",className:"w-4 h-4"}),"Neue Vorlage"]})]}),t.jsx(W,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:90",className:"p-4",children:t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:91",className:"relative",children:[t.jsx(bt,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:92",className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),t.jsx(j,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:93",placeholder:"Suche nach Vorlagenname...",value:x,onChange:a=>k(a.target.value),className:"pl-10"})]})}),V?t.jsx("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:104",className:"text-center py-12",children:t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:105",className:"text-muted-foreground",children:"Lade Vorlagen..."})}):!p||p.length===0?t.jsxs(W,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:108",className:"p-12 text-center",children:[t.jsx(rt,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:109",className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),t.jsx("h3",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:110",className:"text-lg font-semibold mb-2",children:"Keine Vorlagen gefunden"}),t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:111",className:"text-muted-foreground mb-4",children:"Erstellen Sie Ihre erste Vertragsvorlage, um schneller VertrÃ¤ge zu erstellen."}),t.jsxs(d,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:114",onClick:()=>f(!0),children:[t.jsx(Z,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:115",className:"w-4 h-4 mr-2"}),"Erste Vorlage erstellen"]})]}):t.jsx("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:120",className:"grid gap-4",children:p.map(a=>t.jsx(W,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:122",className:"p-6 hover:shadow-lg transition-shadow",children:t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:123",className:"flex items-start justify-between",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:124",className:"flex-1",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:125",className:"flex items-center gap-3 mb-2",children:[t.jsx("h3",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:126",className:"text-lg font-semibold",children:a.name}),t.jsx(ot,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:127",variant:a.isActive===1?"default":"secondary",children:a.isActive===1?"Aktiv":"Inaktiv"}),t.jsx(ot,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:130",variant:"outline",children:R(a.contractType)})]}),a.description&&t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:133",className:"text-sm text-muted-foreground mb-3",children:a.description}),t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:135",className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[t.jsxs("span",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:136",children:["ðŸ“… ",E(a.defaultBillingInterval)]}),t.jsxs("span",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:137",children:["â±ï¸ ",a.defaultDurationMonths," Monate"]}),t.jsxs("span",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:138",children:["ðŸ’° ",a.defaultPaymentTermsDays," Tage Zahlungsziel"]}),a.defaultAutoRenew===1&&t.jsx("span",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:139",children:"ðŸ”„ Auto-VerlÃ¤ngerung"})]})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:143",className:"flex gap-2",children:[t.jsx(d,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:144",variant:"ghost",size:"sm",onClick:()=>N(a.id),children:t.jsx(Dt,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:149",className:"w-4 h-4"})}),t.jsx(d,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:151",variant:"ghost",size:"sm",onClick:()=>u(a.id),children:t.jsx($t,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:156",className:"w-4 h-4"})}),t.jsx(d,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:158",variant:"ghost",size:"sm",onClick:()=>M(a.id,a.isActive),children:a.isActive===1?t.jsx(Gt,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:164",className:"w-4 h-4 text-green-500"}):t.jsx(_t,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:166",className:"w-4 h-4"})}),t.jsx(d,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:169",variant:"ghost",size:"sm",onClick:()=>z(a.id,a.name),children:t.jsx(mt,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:174",className:"w-4 h-4 text-red-500"})})]})]})},a.id))}),t.jsx(et,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:184",open:D,onOpenChange:f,children:t.jsxs(at,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:185",className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[t.jsx(nt,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:186",children:t.jsx(st,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:187",children:"Neue Vertragsvorlage"})}),t.jsx(yt,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:189",onSuccess:()=>{f(!1),y()},onCancel:()=>f(!1)})]})}),g&&t.jsx(et,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:201",open:!!g,onOpenChange:()=>u(null),children:t.jsxs(at,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:202",className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[t.jsx(nt,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:203",children:t.jsx(st,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:204",children:"Vorlage bearbeiten"})}),t.jsx(yt,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:206",templateId:g,onSuccess:()=>{u(null),y()},onCancel:()=>u(null)})]})}),F&&t.jsx(et,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:220",open:!!F,onOpenChange:()=>N(null),children:t.jsxs(at,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:221",className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[t.jsx(nt,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:222",children:t.jsx(st,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:223",children:"Vorlagendetails"})}),t.jsx(Zt,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:225",templateId:F,onClose:()=>N(null)})]})})]})}function Zt({templateId:x,onClose:k}){const{data:D,isLoading:f}=C.contractTemplates.getById.useQuery({id:x});if(f||!D)return t.jsx("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:240",className:"py-8 text-center",children:"Lade Vorlagendetails..."});const{template:g,items:u}=D,F=p=>({service:"Service",license:"Lizenz",support:"Support",hosting:"Hosting",maintenance:"Wartung",other:"Sonstiges"})[p]||p,N=p=>({monthly:"Monatlich",quarterly:"Quartalsweise",yearly:"JÃ¤hrlich",one_time:"Einmalig"})[p]||p;return t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:268",className:"space-y-6",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:269",children:[t.jsx("h3",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:270",className:"text-xl font-bold mb-2",children:g.name}),g.description&&t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:272",className:"text-muted-foreground",children:g.description})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:276",className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:277",className:"p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:278",className:"text-sm text-muted-foreground mb-1",children:"Vertragstyp"}),t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:279",className:"font-medium",children:F(g.contractType)})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:281",className:"p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:282",className:"text-sm text-muted-foreground mb-1",children:"Abrechnungsintervall"}),t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:283",className:"font-medium",children:N(g.defaultBillingInterval)})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:285",className:"p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:286",className:"text-sm text-muted-foreground mb-1",children:"Laufzeit"}),t.jsxs("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:287",className:"font-medium",children:[g.defaultDurationMonths," Monate"]})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:289",className:"p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:290",className:"text-sm text-muted-foreground mb-1",children:"Zahlungsziel"}),t.jsxs("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:291",className:"font-medium",children:[g.defaultPaymentTermsDays," Tage"]})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:293",className:"p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:294",className:"text-sm text-muted-foreground mb-1",children:"Auto-VerlÃ¤ngerung"}),t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:295",className:"font-medium",children:g.defaultAutoRenew===1?"Ja":"Nein"})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:297",className:"p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:298",className:"text-sm text-muted-foreground mb-1",children:"KÃ¼ndigungsfrist"}),t.jsxs("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:299",className:"font-medium",children:[g.defaultRenewalNoticeDays," Tage"]})]})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:303",children:[t.jsx("h4",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:304",className:"font-semibold mb-3",children:"Standard-Positionen"}),t.jsx("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:305",className:"space-y-2",children:u.map(p=>t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:307",className:"p-4 bg-white/5 rounded-lg",children:[t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:308",className:"font-medium mb-1",children:p.description}),t.jsxs("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:309",className:"text-sm text-muted-foreground",children:[p.defaultQuantity," ",p.defaultUnit," Ã— CHF ",p.defaultUnitPrice,parseFloat(p.defaultDiscount)>0&&t.jsxs("span",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:312",className:"text-red-400 ml-2",children:["(-",p.defaultDiscount,"%)"]})]})]},p.id))})]}),g.defaultTerms&&t.jsxs("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:321",children:[t.jsx("h4",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:322",className:"font-semibold mb-3",children:"Standard-Bedingungen"}),t.jsx("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:323",className:"p-4 bg-white/5 rounded-lg",children:t.jsx("p",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:324",className:"text-sm whitespace-pre-wrap",children:g.defaultTerms})})]}),t.jsx("div",{"data-loc":"client/src/components/ContractTemplateManagement.tsx:329",className:"flex justify-end",children:t.jsx(d,{"data-loc":"client/src/components/ContractTemplateManagement.tsx:330",onClick:k,variant:"outline",children:"SchlieÃŸen"})})]})}function Jt({customerId:x,onSuccess:k,onCancel:D}){const[f,g]=o.useState(x),[u,F]=o.useState("none"),[N,p]=o.useState(""),[V,y]=o.useState(""),[I,P]=o.useState("service"),[M,z]=o.useState(""),[R,E]=o.useState(""),[a,w]=o.useState("monthly"),[O,U]=o.useState("30"),[T,S]=o.useState(!1),[L,s]=o.useState("30"),[b,J]=o.useState("none"),[_,X]=o.useState(""),[q,c]=o.useState(""),[e,r]=o.useState([{description:"",quantity:"1",unit:"StÃ¼ck",unitPrice:"0",vatRate:"8.1",discount:"0"}]),{data:Y}=C.customers.all.useQuery({}),{data:St}=C.contractTemplates.getAll.useQuery({activeOnly:!0}),{data:tt}=C.sla.list.useQuery(),{data:dt}=C.contractTemplates.getById.useQuery({id:parseInt(u)},{enabled:u!=="none"});o.useEffect(()=>{if(dt){const{template:n,items:h}=dt;p(n.name),y(n.description||""),P(n.contractType),w(n.defaultBillingInterval),U(n.defaultPaymentTermsDays.toString()),S(n.defaultAutoRenew===1),s(n.defaultRenewalNoticeDays.toString()),c(n.defaultTerms||"");const v=new Date,B=new Date;B.setMonth(B.getMonth()+n.defaultDurationMonths),z(v.toISOString().split("T")[0]),E(B.toISOString().split("T")[0]),r(h.map(A=>({description:A.description,quantity:A.defaultQuantity,unit:A.defaultUnit,unitPrice:A.defaultUnitPrice,vatRate:A.defaultVatRate,discount:A.defaultDiscount})))}},[dt]);const xt=C.contracts.create.useMutation({onSuccess:()=>{m.success("Vertrag erstellt"),k()},onError:n=>{m.error(`Fehler: ${n.message}`)}}),kt=()=>{r([...e,{description:"",quantity:"1",unit:"StÃ¼ck",unitPrice:"0",vatRate:"8.1",discount:"0"}])},Vt=n=>{r(e.filter((h,v)=>v!==n))},G=(n,h,v)=>{const B=[...e];B[n]={...B[n],[h]:v},r(B)},It=()=>{let n=0,h=0,v=0;e.forEach(A=>{const Rt=parseFloat(A.quantity)||0,Pt=parseFloat(A.unitPrice)||0,zt=parseFloat(A.discount)||0,Et=parseFloat(A.vatRate)||0,pt=Rt*Pt,Ct=pt*(zt/100),Lt=(pt-Ct)*(Et/100);n+=pt,h+=Ct,v+=Lt});const B=n-h+v;return{subtotal:n.toFixed(2),discountAmount:h.toFixed(2),vatAmount:v.toFixed(2),total:B.toFixed(2)}},At=n=>{if(n.preventDefault(),!f){m.error("Bitte wÃ¤hlen Sie einen Kunden aus");return}if(!N||!M||!R){m.error("Bitte fÃ¼llen Sie alle Pflichtfelder aus");return}if(e.length===0||e.some(h=>!h.description)){m.error("Bitte fÃ¼gen Sie mindestens eine Position hinzu");return}xt.mutate({customerId:f,title:N,description:V||void 0,contractType:I,startDate:M,endDate:R,billingInterval:a,paymentTermsDays:parseInt(O),autoRenew:T?1:0,renewalNoticeDays:parseInt(L),slaId:b!=="none"?parseInt(b):void 0,slaResponseTime:b!=="none"&&tt?tt.find(h=>h.id===parseInt(b))?.responseTimeMinutes:void 0,slaResolutionTime:b!=="none"&&tt?Math.round((tt.find(h=>h.id===parseInt(b))?.resolutionTimeMinutes||0)/60):void 0,notes:_||void 0,terms:q||void 0,items:e})},it=It();return t.jsxs("form",{"data-loc":"client/src/components/CreateContractForm.tsx:204",onSubmit:At,className:"space-y-6",children:[!x&&t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:207",className:"space-y-2",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:208",htmlFor:"customer",children:"Kunde *"}),t.jsxs(K,{"data-loc":"client/src/components/CreateContractForm.tsx:209",value:f?.toString(),onValueChange:n=>g(parseInt(n)),children:[t.jsx(Q,{"data-loc":"client/src/components/CreateContractForm.tsx:213",children:t.jsx($,{"data-loc":"client/src/components/CreateContractForm.tsx:214",placeholder:"Kunde auswÃ¤hlen"})}),t.jsx(H,{"data-loc":"client/src/components/CreateContractForm.tsx:216",children:Y?.map(n=>t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:218",value:n.id.toString(),children:n.name},n.id))})]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:228",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:229",htmlFor:"template",children:"Aus Vorlage erstellen (optional)"}),t.jsxs(K,{"data-loc":"client/src/components/CreateContractForm.tsx:230",value:u,onValueChange:F,children:[t.jsx(Q,{"data-loc":"client/src/components/CreateContractForm.tsx:231",children:t.jsx($,{"data-loc":"client/src/components/CreateContractForm.tsx:232",placeholder:"Keine Vorlage"})}),t.jsxs(H,{"data-loc":"client/src/components/CreateContractForm.tsx:234",children:[t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:235",value:"none",children:"Keine Vorlage"}),St?.map(n=>t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:237",value:n.id.toString(),children:n.name},n.id))]})]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:246",className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:247",className:"col-span-2 space-y-2",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:248",htmlFor:"title",children:"Vertragsbezeichnung *"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractForm.tsx:249",id:"title",value:N,onChange:n=>p(n.target.value),placeholder:"z.B. IT-Support-Vertrag 2025",required:!0})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:258",className:"col-span-2 space-y-2",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:259",htmlFor:"description",children:"Beschreibung"}),t.jsx(ct,{"data-loc":"client/src/components/CreateContractForm.tsx:260",id:"description",value:V,onChange:n=>y(n.target.value),placeholder:"Optionale Beschreibung des Vertrags",rows:3})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:269",className:"space-y-2",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:270",htmlFor:"contractType",children:"Vertragstyp"}),t.jsxs(K,{"data-loc":"client/src/components/CreateContractForm.tsx:271",value:I,onValueChange:P,children:[t.jsx(Q,{"data-loc":"client/src/components/CreateContractForm.tsx:272",children:t.jsx($,{"data-loc":"client/src/components/CreateContractForm.tsx:273"})}),t.jsxs(H,{"data-loc":"client/src/components/CreateContractForm.tsx:275",children:[t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:276",value:"service",children:"Service"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:277",value:"license",children:"Lizenz"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:278",value:"support",children:"Support"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:279",value:"hosting",children:"Hosting"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:280",value:"maintenance",children:"Wartung"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:281",value:"other",children:"Sonstiges"})]})]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:286",className:"space-y-2",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:287",htmlFor:"billingInterval",children:"Abrechnungsintervall"}),t.jsxs(K,{"data-loc":"client/src/components/CreateContractForm.tsx:288",value:a,onValueChange:w,children:[t.jsx(Q,{"data-loc":"client/src/components/CreateContractForm.tsx:289",children:t.jsx($,{"data-loc":"client/src/components/CreateContractForm.tsx:290"})}),t.jsxs(H,{"data-loc":"client/src/components/CreateContractForm.tsx:292",children:[t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:293",value:"monthly",children:"Monatlich"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:294",value:"quarterly",children:"Quartalsweise"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:295",value:"yearly",children:"JÃ¤hrlich"}),t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:296",value:"one_time",children:"Einmalig"})]})]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:301",className:"space-y-2",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:302",htmlFor:"startDate",children:"Startdatum *"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractForm.tsx:303",id:"startDate",type:"date",value:M,onChange:n=>z(n.target.value),required:!0})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:312",className:"space-y-2",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:313",htmlFor:"endDate",children:"Enddatum *"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractForm.tsx:314",id:"endDate",type:"date",value:R,onChange:n=>E(n.target.value),required:!0})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:323",className:"space-y-2",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:324",htmlFor:"paymentTermsDays",children:"Zahlungsziel (Tage)"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractForm.tsx:325",id:"paymentTermsDays",type:"number",value:O,onChange:n=>U(n.target.value),min:"1"})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:334",className:"space-y-2",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:335",htmlFor:"renewalNoticeDays",children:"KÃ¼ndigungsfrist (Tage)"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractForm.tsx:336",id:"renewalNoticeDays",type:"number",value:L,onChange:n=>s(n.target.value),min:"1"})]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:347",className:"flex items-center gap-2",children:[t.jsx("input",{"data-loc":"client/src/components/CreateContractForm.tsx:348",type:"checkbox",id:"autoRenew",checked:T,onChange:n=>S(n.target.checked),className:"rounded"}),t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:355",htmlFor:"autoRenew",className:"cursor-pointer",children:"Automatische VerlÃ¤ngerung"})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:361",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:362",htmlFor:"sla",children:"SLA-Richtlinie (optional)"}),t.jsxs(K,{"data-loc":"client/src/components/CreateContractForm.tsx:363",value:b,onValueChange:J,children:[t.jsx(Q,{"data-loc":"client/src/components/CreateContractForm.tsx:364",children:t.jsx($,{"data-loc":"client/src/components/CreateContractForm.tsx:365",placeholder:"Keine SLA"})}),t.jsxs(H,{"data-loc":"client/src/components/CreateContractForm.tsx:367",children:[t.jsx(l,{"data-loc":"client/src/components/CreateContractForm.tsx:368",value:"none",children:"Keine SLA"}),tt?.map(n=>t.jsxs(l,{"data-loc":"client/src/components/CreateContractForm.tsx:370",value:n.id.toString(),children:[n.name," (Reaktion: ",n.responseTimeMinutes,"min, LÃ¶sung: ",Math.round(n.resolutionTimeMinutes/60),"h)"]},n.id))]})]}),t.jsx("p",{"data-loc":"client/src/components/CreateContractForm.tsx:376",className:"text-xs text-muted-foreground mt-1",children:"Die SLA-Richtlinie bestimmt die PrioritÃ¤t von Tickets fÃ¼r diesen Kunden."})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:382",className:"space-y-4",children:[t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:383",className:"flex items-center justify-between",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:384",children:"Positionen *"}),t.jsxs(d,{"data-loc":"client/src/components/CreateContractForm.tsx:385",type:"button",onClick:kt,size:"sm",variant:"outline",children:[t.jsx(Z,{"data-loc":"client/src/components/CreateContractForm.tsx:386",className:"h-4 w-4 mr-2"}),"Position hinzufÃ¼gen"]})]}),e.map((n,h)=>t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:392",className:"p-4 border rounded-lg space-y-3 bg-white/5",children:[t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:393",className:"flex items-start justify-between",children:[t.jsxs("span",{"data-loc":"client/src/components/CreateContractForm.tsx:394",className:"text-sm font-medium",children:["Position ",h+1]}),e.length>1&&t.jsx(d,{"data-loc":"client/src/components/CreateContractForm.tsx:396",type:"button",onClick:()=>Vt(h),size:"sm",variant:"ghost",children:t.jsx(mt,{"data-loc":"client/src/components/CreateContractForm.tsx:402",className:"h-4 w-4"})})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:407",className:"grid grid-cols-6 gap-3",children:[t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:408",className:"col-span-6 space-y-1",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:409",className:"text-xs",children:"Beschreibung"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractForm.tsx:410",value:n.description,onChange:v=>G(h,"description",v.target.value),placeholder:"Leistungsbeschreibung",required:!0})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:418",className:"space-y-1",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:419",className:"text-xs",children:"Menge"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractForm.tsx:420",type:"number",value:n.quantity,onChange:v=>G(h,"quantity",v.target.value),step:"0.01",min:"0",required:!0})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:430",className:"space-y-1",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:431",className:"text-xs",children:"Einheit"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractForm.tsx:432",value:n.unit,onChange:v=>G(h,"unit",v.target.value),placeholder:"StÃ¼ck",required:!0})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:440",className:"space-y-1",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:441",className:"text-xs",children:"Einzelpreis"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractForm.tsx:442",type:"number",value:n.unitPrice,onChange:v=>G(h,"unitPrice",v.target.value),step:"0.01",min:"0",required:!0})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:452",className:"space-y-1",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:453",className:"text-xs",children:"MwSt. %"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractForm.tsx:454",type:"number",value:n.vatRate,onChange:v=>G(h,"vatRate",v.target.value),step:"0.01",min:"0",required:!0})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:464",className:"space-y-1",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:465",className:"text-xs",children:"Rabatt %"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractForm.tsx:466",type:"number",value:n.discount,onChange:v=>G(h,"discount",v.target.value),step:"0.01",min:"0",max:"100"})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:476",className:"space-y-1",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:477",className:"text-xs",children:"Gesamt"}),t.jsx(j,{"data-loc":"client/src/components/CreateContractForm.tsx:478",value:(()=>{const v=parseFloat(n.quantity)||0,B=parseFloat(n.unitPrice)||0,A=parseFloat(n.discount)||0;return(v*B*(1-A/100)).toFixed(2)})(),disabled:!0,className:"bg-muted"})]})]})]},h))]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:495",className:"p-4 border rounded-lg bg-white/5 space-y-2",children:[t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:496",className:"flex justify-between text-sm",children:[t.jsx("span",{"data-loc":"client/src/components/CreateContractForm.tsx:497",children:"Zwischensumme:"}),t.jsxs("span",{"data-loc":"client/src/components/CreateContractForm.tsx:498",className:"font-medium",children:["CHF ",it.subtotal]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:500",className:"flex justify-between text-sm",children:[t.jsx("span",{"data-loc":"client/src/components/CreateContractForm.tsx:501",children:"Rabatt:"}),t.jsxs("span",{"data-loc":"client/src/components/CreateContractForm.tsx:502",className:"font-medium text-red-500",children:["- CHF ",it.discountAmount]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:504",className:"flex justify-between text-sm",children:[t.jsx("span",{"data-loc":"client/src/components/CreateContractForm.tsx:505",children:"MwSt.:"}),t.jsxs("span",{"data-loc":"client/src/components/CreateContractForm.tsx:506",className:"font-medium",children:["CHF ",it.vatAmount]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:508",className:"flex justify-between text-lg font-bold border-t pt-2",children:[t.jsx("span",{"data-loc":"client/src/components/CreateContractForm.tsx:509",children:"Gesamtbetrag:"}),t.jsxs("span",{"data-loc":"client/src/components/CreateContractForm.tsx:510",className:"text-yellow-500",children:["CHF ",it.total]})]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:515",className:"space-y-4",children:[t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:516",className:"space-y-2",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:517",htmlFor:"notes",children:"Interne Notizen"}),t.jsx(ct,{"data-loc":"client/src/components/CreateContractForm.tsx:518",id:"notes",value:_,onChange:n=>X(n.target.value),placeholder:"Interne Notizen (nicht fÃ¼r Kunden sichtbar)",rows:3})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:527",className:"space-y-2",children:[t.jsx(i,{"data-loc":"client/src/components/CreateContractForm.tsx:528",htmlFor:"terms",children:"Vertragsbedingungen"}),t.jsx(ct,{"data-loc":"client/src/components/CreateContractForm.tsx:529",id:"terms",value:q,onChange:n=>c(n.target.value),placeholder:"Allgemeine GeschÃ¤ftsbedingungen und Vertragsbedingungen",rows:4})]})]}),t.jsxs("div",{"data-loc":"client/src/components/CreateContractForm.tsx:540",className:"flex justify-end gap-3",children:[t.jsx(d,{"data-loc":"client/src/components/CreateContractForm.tsx:541",type:"button",variant:"outline",onClick:D,children:"Abbrechen"}),t.jsx(d,{"data-loc":"client/src/components/CreateContractForm.tsx:544",type:"submit",disabled:xt.isPending,children:xt.isPending?"Erstelle...":"Vertrag erstellen"})]})]})}function Xt({contractId:x,onClose:k,onUpdate:D}){const{data:f,isLoading:g}=C.contracts.getById.useQuery({id:x}),{data:u}=C.contractSignature.getSignatureStatus.useQuery({contractId:x}),{data:F}=C.contractPdf.getAttachments.useQuery({contractId:x}),[N,p]=o.useState(""),[V,y]=o.useState(!1),I=C.contracts.updateStatus.useMutation({onSuccess:()=>{m.success("Status aktualisiert"),D(),k()},onError:e=>{m.error(`Fehler: ${e.message}`)}}),P=C.contracts.convertToInvoice.useMutation({onSuccess:e=>{m.success(`Rechnung ${e.invoiceNumber} erstellt`),D()},onError:e=>{m.error(`Fehler: ${e.message}`)}}),M=C.contracts.convertToRecurringInvoice.useMutation({onSuccess:()=>{m.success("Wiederkehrende Rechnung erstellt"),D()},onError:e=>{m.error(`Fehler: ${e.message}`)}}),z=C.contractPdf.generatePdf.useMutation({onSuccess:e=>{m.success("PDF erfolgreich generiert"),window.open(e.url,"_blank"),y(!1),D()},onError:e=>{m.error(`Fehler: ${e.message}`),y(!1)}}),R=C.contractSignature.signAsCustomer.useMutation({onSuccess:()=>{m.success("Vertrag als Kunde signiert"),D()},onError:e=>{m.error(`Fehler: ${e.message}`)}}),E=C.contractSignature.signAsCompany.useMutation({onSuccess:()=>{m.success("Vertrag als Firma signiert"),D()},onError:e=>{m.error(`Fehler: ${e.message}`)}});if(g||!f)return t.jsx("div",{"data-loc":"client/src/components/ContractDetails.tsx:105",className:"py-8 text-center",children:"Lade Vertragsdaten..."});const{contract:a,items:w}=f,O=e=>({draft:"bg-gray-500",active:"bg-green-500",expired:"bg-orange-500",cancelled:"bg-red-500",renewed:"bg-blue-500"})[e]||"bg-gray-500",U=e=>({draft:"Entwurf",active:"Aktiv",expired:"Abgelaufen",cancelled:"GekÃ¼ndigt",renewed:"Erneuert"})[e]||e,T=e=>{const r=typeof e=="string"?parseFloat(e):e;return new Intl.NumberFormat("de-CH",{style:"currency",currency:"CHF"}).format(r)},S=e=>e?new Date(e).toLocaleDateString("de-CH"):"-",L=()=>{if(!N)return;const e={id:x,status:N};if(N==="active")e.signedDate=new Date().toISOString();else if(N==="cancelled"){e.cancelledDate=new Date().toISOString();const r=prompt("KÃ¼ndigungsgrund (optional):");r&&(e.cancellationReason=r)}I.mutate(e)},s=()=>{confirm("MÃ¶chten Sie aus diesem Vertrag eine Rechnung erstellen?")&&P.mutate({contractId:x})},b=()=>{confirm("MÃ¶chten Sie aus diesem Vertrag eine wiederkehrende Rechnung erstellen?")&&M.mutate({contractId:x})},J=()=>{y(!0),z.mutate({contractId:x})},_=()=>{const e=prompt("Name des Unterzeichners (Kunde):");e&&R.mutate({contractId:x,signerName:e})},X=()=>{confirm("MÃ¶chten Sie diesen Vertrag als Firma signieren?")&&E.mutate({contractId:x})},q=e=>({unsigned:"Nicht signiert",customer_signed:"Kunde signiert",company_signed:"Firma signiert",fully_signed:"VollstÃ¤ndig signiert"})[e]||e,c=e=>({unsigned:"bg-gray-500",customer_signed:"bg-yellow-500",company_signed:"bg-yellow-500",fully_signed:"bg-green-500"})[e]||"bg-gray-500";return t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:217",className:"space-y-6",children:[t.jsx("div",{"data-loc":"client/src/components/ContractDetails.tsx:219",className:"flex items-start justify-between",children:t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:220",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:221",className:"flex items-center gap-3 mb-2",children:[t.jsx("h3",{"data-loc":"client/src/components/ContractDetails.tsx:222",className:"text-2xl font-bold",children:a.title}),t.jsx(ot,{"data-loc":"client/src/components/ContractDetails.tsx:223",className:`${O(a.status)} text-white`,children:U(a.status)})]}),t.jsxs("p",{"data-loc":"client/src/components/ContractDetails.tsx:227",className:"text-sm text-muted-foreground",children:["Vertragsnummer: ",a.contractNumber]})]})}),a.description&&t.jsx("div",{"data-loc":"client/src/components/ContractDetails.tsx:235",className:"p-4 bg-white/5 rounded-lg",children:t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:236",className:"text-sm",children:a.description})}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:241",className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:242",className:"p-4 bg-white/5 rounded-lg",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:243",className:"flex items-center gap-2 mb-2",children:[t.jsx(jt,{"data-loc":"client/src/components/ContractDetails.tsx:244",className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:245",className:"text-sm text-muted-foreground",children:"Laufzeit"})]}),t.jsxs("p",{"data-loc":"client/src/components/ContractDetails.tsx:247",className:"font-medium",children:[S(a.startDate)," - ",S(a.endDate)]})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:252",className:"p-4 bg-white/5 rounded-lg",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:253",className:"flex items-center gap-2 mb-2",children:[t.jsx(vt,{"data-loc":"client/src/components/ContractDetails.tsx:254",className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:255",className:"text-sm text-muted-foreground",children:"Abrechnungsintervall"})]}),t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:257",className:"font-medium capitalize",children:a.billingInterval})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:260",className:"p-4 bg-white/5 rounded-lg",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:261",className:"flex items-center gap-2 mb-2",children:[t.jsx(Ht,{"data-loc":"client/src/components/ContractDetails.tsx:262",className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:263",className:"text-sm text-muted-foreground",children:"Gesamtwert"})]}),t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:265",className:"font-medium text-yellow-500",children:T(a.totalAmount)})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:270",className:"p-4 bg-white/5 rounded-lg",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:271",className:"flex items-center gap-2 mb-2",children:[t.jsx(rt,{"data-loc":"client/src/components/ContractDetails.tsx:272",className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:273",className:"text-sm text-muted-foreground",children:"Vertragstyp"})]}),t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:275",className:"font-medium capitalize",children:a.contractType})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:278",className:"p-4 bg-white/5 rounded-lg",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:279",className:"flex items-center gap-2 mb-2",children:[t.jsx(vt,{"data-loc":"client/src/components/ContractDetails.tsx:280",className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:281",className:"text-sm text-muted-foreground",children:"Zahlungsziel"})]}),t.jsxs("p",{"data-loc":"client/src/components/ContractDetails.tsx:283",className:"font-medium",children:[a.paymentTermsDays," Tage"]})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:286",className:"p-4 bg-white/5 rounded-lg",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:287",className:"flex items-center gap-2 mb-2",children:[t.jsx(jt,{"data-loc":"client/src/components/ContractDetails.tsx:288",className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:289",className:"text-sm text-muted-foreground",children:"KÃ¼ndigungsfrist"})]}),t.jsxs("p",{"data-loc":"client/src/components/ContractDetails.tsx:291",className:"font-medium",children:[a.renewalNoticeDays," Tage"]})]})]}),a.autoRenew===1&&t.jsx("div",{"data-loc":"client/src/components/ContractDetails.tsx:297",className:"p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:298",className:"text-sm font-medium text-blue-400",children:"âœ“ Automatische VerlÃ¤ngerung aktiviert"})}),u&&t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:306",className:"p-4 bg-white/5 rounded-lg space-y-3",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:307",className:"flex items-center justify-between",children:[t.jsx("h4",{"data-loc":"client/src/components/ContractDetails.tsx:308",className:"font-semibold",children:"Signatur-Status"}),t.jsx(ot,{"data-loc":"client/src/components/ContractDetails.tsx:309",className:`${c(u.signatureStatus)} text-white`,children:q(u.signatureStatus)})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:313",className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:314",className:"p-3 bg-white/5 rounded-lg",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:315",className:"flex items-center gap-2 mb-2",children:[t.jsx(ft,{"data-loc":"client/src/components/ContractDetails.tsx:316",className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:317",className:"text-sm text-muted-foreground",children:"Kunde"})]}),u.customerSignedAt?t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:320",children:[t.jsxs("p",{"data-loc":"client/src/components/ContractDetails.tsx:321",className:"font-medium text-green-400 flex items-center gap-1",children:[t.jsx(Nt,{"data-loc":"client/src/components/ContractDetails.tsx:322",className:"h-4 w-4"})," Signiert"]}),t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:324",className:"text-xs text-muted-foreground mt-1",children:u.customerSignedBy}),t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:327",className:"text-xs text-muted-foreground",children:S(u.customerSignedAt)})]}):t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:332",className:"text-sm text-muted-foreground",children:"Ausstehend"})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:335",className:"p-3 bg-white/5 rounded-lg",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:336",className:"flex items-center gap-2 mb-2",children:[t.jsx(Tt,{"data-loc":"client/src/components/ContractDetails.tsx:337",className:"h-4 w-4 text-muted-foreground"}),t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:338",className:"text-sm text-muted-foreground",children:"Firma"})]}),u.companySignedAt?t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:341",children:[t.jsxs("p",{"data-loc":"client/src/components/ContractDetails.tsx:342",className:"font-medium text-green-400 flex items-center gap-1",children:[t.jsx(Nt,{"data-loc":"client/src/components/ContractDetails.tsx:343",className:"h-4 w-4"})," Signiert"]}),t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:345",className:"text-xs text-muted-foreground mt-1",children:S(u.companySignedAt)})]}):t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:350",className:"text-sm text-muted-foreground",children:"Ausstehend"})]})]}),u.signatureStatus!=="fully_signed"&&t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:355",className:"flex gap-2",children:[!u.customerSignedAt&&t.jsxs(d,{"data-loc":"client/src/components/ContractDetails.tsx:357",onClick:_,variant:"outline",size:"sm",children:[t.jsx(ft,{"data-loc":"client/src/components/ContractDetails.tsx:358",className:"h-4 w-4 mr-2"}),"Als Kunde signieren"]}),!u.companySignedAt&&t.jsxs(d,{"data-loc":"client/src/components/ContractDetails.tsx:363",onClick:X,variant:"outline",size:"sm",children:[t.jsx(Tt,{"data-loc":"client/src/components/ContractDetails.tsx:364",className:"h-4 w-4 mr-2"}),"Als Firma signieren"]})]})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:374",className:"p-4 bg-white/5 rounded-lg space-y-3",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:375",className:"flex items-center justify-between",children:[t.jsx("h4",{"data-loc":"client/src/components/ContractDetails.tsx:376",className:"font-semibold",children:"Dokumente"}),t.jsxs(d,{"data-loc":"client/src/components/ContractDetails.tsx:377",onClick:J,disabled:V,size:"sm",children:[t.jsx(Ft,{"data-loc":"client/src/components/ContractDetails.tsx:382",className:"h-4 w-4 mr-2"}),V?"Generiere PDF...":"PDF exportieren"]})]}),F&&F.length>0&&t.jsx("div",{"data-loc":"client/src/components/ContractDetails.tsx:387",className:"space-y-2",children:F.map(e=>t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:389",className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:390",className:"flex items-center gap-3",children:[t.jsx(rt,{"data-loc":"client/src/components/ContractDetails.tsx:391",className:"h-4 w-4 text-muted-foreground"}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:392",children:[t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:393",className:"text-sm font-medium",children:e.fileName}),t.jsxs("p",{"data-loc":"client/src/components/ContractDetails.tsx:394",className:"text-xs text-muted-foreground",children:[(e.fileSize/1024).toFixed(2)," KB â€¢ ",S(e.createdAt)]})]})]}),t.jsx(d,{"data-loc":"client/src/components/ContractDetails.tsx:399",size:"sm",variant:"ghost",onClick:()=>window.open(e.fileUrl,"_blank"),children:t.jsx(Ft,{"data-loc":"client/src/components/ContractDetails.tsx:404",className:"h-4 w-4"})})]},e.id))})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:413",className:"space-y-3",children:[t.jsx("h4",{"data-loc":"client/src/components/ContractDetails.tsx:414",className:"font-semibold",children:"Positionen"}),t.jsx("div",{"data-loc":"client/src/components/ContractDetails.tsx:415",className:"space-y-2",children:w.map((e,r)=>t.jsx("div",{"data-loc":"client/src/components/ContractDetails.tsx:417",className:"p-4 bg-white/5 rounded-lg",children:t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:418",className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:419",className:"flex-1",children:[t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:420",className:"font-medium",children:e.description}),t.jsxs("p",{"data-loc":"client/src/components/ContractDetails.tsx:421",className:"text-sm text-muted-foreground mt-1",children:[e.quantity," ",e.unit," Ã— ",T(e.unitPrice),parseFloat(e.discount)>0&&t.jsxs("span",{"data-loc":"client/src/components/ContractDetails.tsx:424",className:"text-red-400 ml-2",children:["(-",e.discount,"% Rabatt)"]})]})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:430",className:"text-right",children:[t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:431",className:"font-medium",children:T(e.total)}),t.jsxs("p",{"data-loc":"client/src/components/ContractDetails.tsx:432",className:"text-xs text-muted-foreground",children:["inkl. ",e.vatRate,"% MwSt."]})]})]})},e.id))})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:443",className:"p-4 bg-white/5 rounded-lg space-y-2",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:444",className:"flex justify-between text-sm",children:[t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:445",children:"Zwischensumme:"}),t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:446",className:"font-medium",children:T(a.subtotal)})]}),parseFloat(a.discountAmount)>0&&t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:449",className:"flex justify-between text-sm",children:[t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:450",children:"Rabatt:"}),t.jsxs("span",{"data-loc":"client/src/components/ContractDetails.tsx:451",className:"font-medium text-red-500",children:["- ",T(a.discountAmount)]})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:456",className:"flex justify-between text-sm",children:[t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:457",children:"MwSt.:"}),t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:458",className:"font-medium",children:T(a.vatAmount)})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:460",className:"flex justify-between text-lg font-bold border-t pt-2",children:[t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:461",children:"Gesamtbetrag:"}),t.jsx("span",{"data-loc":"client/src/components/ContractDetails.tsx:462",className:"text-yellow-500",children:T(a.totalAmount)})]})]}),a.notes&&t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:468",className:"space-y-2",children:[t.jsx("h4",{"data-loc":"client/src/components/ContractDetails.tsx:469",className:"font-semibold",children:"Interne Notizen"}),t.jsx("div",{"data-loc":"client/src/components/ContractDetails.tsx:470",className:"p-4 bg-white/5 rounded-lg",children:t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:471",className:"text-sm whitespace-pre-wrap",children:a.notes})})]}),a.terms&&t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:478",className:"space-y-2",children:[t.jsx("h4",{"data-loc":"client/src/components/ContractDetails.tsx:479",className:"font-semibold",children:"Vertragsbedingungen"}),t.jsx("div",{"data-loc":"client/src/components/ContractDetails.tsx:480",className:"p-4 bg-white/5 rounded-lg",children:t.jsx("p",{"data-loc":"client/src/components/ContractDetails.tsx:481",className:"text-sm whitespace-pre-wrap",children:a.terms})})]}),a.status==="draft"&&t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:488",className:"p-4 bg-white/5 rounded-lg space-y-3",children:[t.jsx("h4",{"data-loc":"client/src/components/ContractDetails.tsx:489",className:"font-semibold",children:"Status Ã¤ndern"}),t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:490",className:"flex gap-3",children:[t.jsxs(K,{"data-loc":"client/src/components/ContractDetails.tsx:491",value:N,onValueChange:p,children:[t.jsx(Q,{"data-loc":"client/src/components/ContractDetails.tsx:492",className:"flex-1",children:t.jsx($,{"data-loc":"client/src/components/ContractDetails.tsx:493",placeholder:"Neuen Status wÃ¤hlen"})}),t.jsxs(H,{"data-loc":"client/src/components/ContractDetails.tsx:495",children:[t.jsx(l,{"data-loc":"client/src/components/ContractDetails.tsx:496",value:"active",children:"Aktiv"}),t.jsx(l,{"data-loc":"client/src/components/ContractDetails.tsx:497",value:"cancelled",children:"GekÃ¼ndigt"})]})]}),t.jsx(d,{"data-loc":"client/src/components/ContractDetails.tsx:500",onClick:L,disabled:!N,children:"Status aktualisieren"})]})]}),a.status==="active"&&t.jsxs("div",{"data-loc":"client/src/components/ContractDetails.tsx:509",className:"flex gap-3",children:[t.jsxs(d,{"data-loc":"client/src/components/ContractDetails.tsx:510",onClick:s,className:"flex-1",children:[t.jsx(Mt,{"data-loc":"client/src/components/ContractDetails.tsx:511",className:"h-4 w-4 mr-2"}),"In Rechnung umwandeln"]}),a.billingInterval!=="one_time"&&!a.recurringInvoiceId&&t.jsxs(d,{"data-loc":"client/src/components/ContractDetails.tsx:515",onClick:b,variant:"outline",className:"flex-1",children:[t.jsx(wt,{"data-loc":"client/src/components/ContractDetails.tsx:516",className:"h-4 w-4 mr-2"}),"Wiederkehrende Rechnung"]})]}),a.recurringInvoiceId&&t.jsx("div",{"data-loc":"client/src/components/ContractDetails.tsx:524",className:"p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:t.jsxs("p",{"data-loc":"client/src/components/ContractDetails.tsx:525",className:"text-sm font-medium text-green-400",children:["âœ“ Wiederkehrende Rechnung ist aktiv (ID: ",a.recurringInvoiceId,")"]})}),t.jsx("div",{"data-loc":"client/src/components/ContractDetails.tsx:532",className:"flex justify-end",children:t.jsx(d,{"data-loc":"client/src/components/ContractDetails.tsx:533",onClick:k,variant:"outline",children:"SchlieÃŸen"})})]})}function Yt({customerId:x}){const[k,D]=o.useState(""),[f,g]=o.useState("all"),[u,F]=o.useState(!1),[N,p]=o.useState(null),[V,y]=o.useState(!1),{data:I,isLoading:P,refetch:M}=C.contracts.getAll.useQuery({customerId:x,status:f==="all"?void 0:f,search:k||void 0}),z=C.contracts.delete.useMutation({onSuccess:()=>{m.success("Vertrag gelÃ¶scht"),M()},onError:s=>{m.error(`Fehler: ${s.message}`)}}),R=C.contracts.convertToInvoice.useMutation({onSuccess:s=>{m.success(`Rechnung ${s.invoiceNumber} erstellt`),M()},onError:s=>{m.error(`Fehler: ${s.message}`)}}),E=C.contracts.convertToRecurringInvoice.useMutation({onSuccess:()=>{m.success("Wiederkehrende Rechnung erstellt"),M()},onError:s=>{m.error(`Fehler: ${s.message}`)}}),a=s=>{confirm("MÃ¶chten Sie diesen Vertrag wirklich lÃ¶schen?")&&z.mutate({id:s})},w=s=>{confirm("MÃ¶chten Sie aus diesem Vertrag eine Rechnung erstellen?")&&R.mutate({contractId:s})},O=s=>{confirm("MÃ¶chten Sie aus diesem Vertrag eine wiederkehrende Rechnung erstellen?")&&E.mutate({contractId:s})},U=s=>({draft:"bg-gray-500",active:"bg-green-500",expired:"bg-orange-500",cancelled:"bg-red-500",renewed:"bg-blue-500"})[s]||"bg-gray-500",T=s=>({draft:"Entwurf",active:"Aktiv",expired:"Abgelaufen",cancelled:"GekÃ¼ndigt",renewed:"Erneuert"})[s]||s,S=s=>{const b=typeof s=="string"?parseFloat(s):s;return new Intl.NumberFormat("de-CH",{style:"currency",currency:"CHF"}).format(b)},L=s=>new Date(s).toLocaleDateString("de-CH");return t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:137",className:"space-y-6",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:139",className:"flex items-center justify-between",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:140",children:[t.jsx("h2",{"data-loc":"client/src/components/ContractManagement.tsx:141",className:"text-2xl font-bold",children:"VertrÃ¤ge"}),t.jsx("p",{"data-loc":"client/src/components/ContractManagement.tsx:142",className:"text-muted-foreground",children:"Verwalten Sie KundenvertrÃ¤ge und erstellen Sie Rechnungen"})]}),t.jsxs(d,{"data-loc":"client/src/components/ContractManagement.tsx:144",onClick:()=>F(!0),children:[t.jsx(Z,{"data-loc":"client/src/components/ContractManagement.tsx:145",className:"h-4 w-4 mr-2"}),"Neuer Vertrag"]})]}),t.jsx(W,{"data-loc":"client/src/components/ContractManagement.tsx:151",className:"bg-white/5 border-white/10",children:t.jsx(ut,{"data-loc":"client/src/components/ContractManagement.tsx:152",className:"pt-6",children:t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:153",className:"flex gap-4",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:154",className:"flex-1 relative",children:[t.jsx(bt,{"data-loc":"client/src/components/ContractManagement.tsx:155",className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(j,{"data-loc":"client/src/components/ContractManagement.tsx:156",placeholder:"VertrÃ¤ge durchsuchen...",value:k,onChange:s=>D(s.target.value),className:"pl-10"})]}),t.jsxs(K,{"data-loc":"client/src/components/ContractManagement.tsx:163",value:f,onValueChange:g,children:[t.jsx(Q,{"data-loc":"client/src/components/ContractManagement.tsx:164",className:"w-[200px]",children:t.jsx($,{"data-loc":"client/src/components/ContractManagement.tsx:165"})}),t.jsxs(H,{"data-loc":"client/src/components/ContractManagement.tsx:167",children:[t.jsx(l,{"data-loc":"client/src/components/ContractManagement.tsx:168",value:"all",children:"Alle Status"}),t.jsx(l,{"data-loc":"client/src/components/ContractManagement.tsx:169",value:"draft",children:"Entwurf"}),t.jsx(l,{"data-loc":"client/src/components/ContractManagement.tsx:170",value:"active",children:"Aktiv"}),t.jsx(l,{"data-loc":"client/src/components/ContractManagement.tsx:171",value:"expired",children:"Abgelaufen"}),t.jsx(l,{"data-loc":"client/src/components/ContractManagement.tsx:172",value:"cancelled",children:"GekÃ¼ndigt"}),t.jsx(l,{"data-loc":"client/src/components/ContractManagement.tsx:173",value:"renewed",children:"Erneuert"})]})]})]})})}),P?t.jsx("div",{"data-loc":"client/src/components/ContractManagement.tsx:182",className:"text-center py-12",children:t.jsx("p",{"data-loc":"client/src/components/ContractManagement.tsx:183",className:"text-muted-foreground",children:"Lade VertrÃ¤ge..."})}):I&&I.length>0?t.jsx("div",{"data-loc":"client/src/components/ContractManagement.tsx:186",className:"grid gap-4",children:I.map(({contract:s,customer:b})=>t.jsx(W,{"data-loc":"client/src/components/ContractManagement.tsx:188",className:"bg-white/5 border-white/10 hover:bg-white/10 transition-colors",children:t.jsx(ut,{"data-loc":"client/src/components/ContractManagement.tsx:189",className:"p-6",children:t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:190",className:"flex items-start justify-between",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:191",className:"flex-1",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:192",className:"flex items-center gap-3 mb-2",children:[t.jsx(rt,{"data-loc":"client/src/components/ContractManagement.tsx:193",className:"h-5 w-5 text-yellow-500"}),t.jsx("h3",{"data-loc":"client/src/components/ContractManagement.tsx:194",className:"text-lg font-semibold",children:s.title}),t.jsx(ot,{"data-loc":"client/src/components/ContractManagement.tsx:195",className:`${U(s.status)} text-white`,children:T(s.status)})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:199",className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 text-sm",children:[t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:200",children:[t.jsx("p",{"data-loc":"client/src/components/ContractManagement.tsx:201",className:"text-muted-foreground",children:"Vertragsnummer"}),t.jsx("p",{"data-loc":"client/src/components/ContractManagement.tsx:202",className:"font-medium",children:s.contractNumber})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:204",children:[t.jsx("p",{"data-loc":"client/src/components/ContractManagement.tsx:205",className:"text-muted-foreground",children:"Kunde"}),t.jsx("p",{"data-loc":"client/src/components/ContractManagement.tsx:206",className:"font-medium",children:b?.name||"Unbekannt"})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:208",children:[t.jsx("p",{"data-loc":"client/src/components/ContractManagement.tsx:209",className:"text-muted-foreground",children:"Laufzeit"}),t.jsxs("p",{"data-loc":"client/src/components/ContractManagement.tsx:210",className:"font-medium",children:[L(s.startDate)," - ",L(s.endDate)]})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:214",children:[t.jsx("p",{"data-loc":"client/src/components/ContractManagement.tsx:215",className:"text-muted-foreground",children:"Wert"}),t.jsx("p",{"data-loc":"client/src/components/ContractManagement.tsx:216",className:"font-medium text-yellow-500",children:S(s.totalAmount)})]})]}),s.description&&t.jsx("p",{"data-loc":"client/src/components/ContractManagement.tsx:220",className:"text-sm text-muted-foreground mt-3 line-clamp-2",children:s.description})]}),t.jsxs("div",{"data-loc":"client/src/components/ContractManagement.tsx:225",className:"flex gap-2 ml-4",children:[t.jsx(d,{"data-loc":"client/src/components/ContractManagement.tsx:226",variant:"ghost",size:"sm",onClick:()=>{p(s.id),y(!0)},title:"Details anzeigen",children:t.jsx(Dt,{"data-loc":"client/src/components/ContractManagement.tsx:235",className:"h-4 w-4"})}),s.status==="active"&&t.jsxs(t.Fragment,{children:[t.jsx(d,{"data-loc":"client/src/components/ContractManagement.tsx:239",variant:"ghost",size:"sm",onClick:()=>w(s.id),title:"In Rechnung umwandeln",children:t.jsx(Mt,{"data-loc":"client/src/components/ContractManagement.tsx:245",className:"h-4 w-4"})}),s.billingInterval!=="one_time"&&!s.recurringInvoiceId&&t.jsx(d,{"data-loc":"client/src/components/ContractManagement.tsx:248",variant:"ghost",size:"sm",onClick:()=>O(s.id),title:"Wiederkehrende Rechnung erstellen",children:t.jsx(wt,{"data-loc":"client/src/components/ContractManagement.tsx:254",className:"h-4 w-4"})})]}),s.status==="draft"&&t.jsx(d,{"data-loc":"client/src/components/ContractManagement.tsx:260",variant:"ghost",size:"sm",onClick:()=>a(s.id),title:"LÃ¶schen",children:t.jsx(mt,{"data-loc":"client/src/components/ContractManagement.tsx:266",className:"h-4 w-4"})})]})]})})},s.id))}):t.jsx(W,{"data-loc":"client/src/components/ContractManagement.tsx:276",className:"bg-white/5 border-white/10",children:t.jsxs(ut,{"data-loc":"client/src/components/ContractManagement.tsx:277",className:"py-12 text-center",children:[t.jsx(rt,{"data-loc":"client/src/components/ContractManagement.tsx:278",className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),t.jsx("p",{"data-loc":"client/src/components/ContractManagement.tsx:279",className:"text-muted-foreground",children:"Keine VertrÃ¤ge gefunden"}),t.jsxs(d,{"data-loc":"client/src/components/ContractManagement.tsx:280",onClick:()=>F(!0),className:"mt-4",children:[t.jsx(Z,{"data-loc":"client/src/components/ContractManagement.tsx:281",className:"h-4 w-4 mr-2"}),"Ersten Vertrag erstellen"]})]})}),t.jsx(et,{"data-loc":"client/src/components/ContractManagement.tsx:289",open:u,onOpenChange:F,children:t.jsxs(at,{"data-loc":"client/src/components/ContractManagement.tsx:290",className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[t.jsxs(nt,{"data-loc":"client/src/components/ContractManagement.tsx:291",children:[t.jsx(st,{"data-loc":"client/src/components/ContractManagement.tsx:292",children:"Neuer Vertrag"}),t.jsx(Qt,{"data-loc":"client/src/components/ContractManagement.tsx:293",children:"Erstellen Sie einen neuen Kundenvertrag"})]}),t.jsx(Jt,{"data-loc":"client/src/components/ContractManagement.tsx:297",customerId:x,onSuccess:()=>{F(!1),M()},onCancel:()=>F(!1)})]})}),N&&t.jsx(et,{"data-loc":"client/src/components/ContractManagement.tsx:310",open:V,onOpenChange:y,children:t.jsxs(at,{"data-loc":"client/src/components/ContractManagement.tsx:311",className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[t.jsx(nt,{"data-loc":"client/src/components/ContractManagement.tsx:312",children:t.jsx(st,{"data-loc":"client/src/components/ContractManagement.tsx:313",children:"Vertragsdetails"})}),t.jsx(Xt,{"data-loc":"client/src/components/ContractManagement.tsx:315",contractId:N,onClose:()=>{y(!1),p(null)},onUpdate:()=>M()})]})})]})}function Ae(){const[,x]=qt();return t.jsx("div",{"data-loc":"client/src/pages/Contracts.tsx:12",className:"min-h-screen bg-background",children:t.jsxs("div",{"data-loc":"client/src/pages/Contracts.tsx:13",className:"container mx-auto py-8",children:[t.jsxs("div",{"data-loc":"client/src/pages/Contracts.tsx:14",className:"flex items-center justify-between mb-8",children:[t.jsxs(d,{"data-loc":"client/src/pages/Contracts.tsx:15",variant:"ghost",onClick:()=>x("/admin"),size:"sm",children:[t.jsx(Ot,{"data-loc":"client/src/pages/Contracts.tsx:20",className:"h-4 w-4 mr-2"}),"ZurÃ¼ck"]}),t.jsxs(d,{"data-loc":"client/src/pages/Contracts.tsx:23",onClick:()=>x("/contract-dashboard"),variant:"outline",children:[t.jsx(Ut,{"data-loc":"client/src/pages/Contracts.tsx:27",className:"h-4 w-4 mr-2"}),"Dashboard"]})]}),t.jsxs(Bt,{"data-loc":"client/src/pages/Contracts.tsx:32",defaultValue:"contracts",className:"space-y-6",children:[t.jsxs(Kt,{"data-loc":"client/src/pages/Contracts.tsx:33",children:[t.jsx(gt,{"data-loc":"client/src/pages/Contracts.tsx:34",value:"contracts",children:"VertrÃ¤ge"}),t.jsx(gt,{"data-loc":"client/src/pages/Contracts.tsx:35",value:"templates",children:"Vorlagen"})]}),t.jsx(ht,{"data-loc":"client/src/pages/Contracts.tsx:38",value:"contracts",children:t.jsx(Yt,{"data-loc":"client/src/pages/Contracts.tsx:39"})}),t.jsx(ht,{"data-loc":"client/src/pages/Contracts.tsx:42",value:"templates",children:t.jsx(Wt,{"data-loc":"client/src/pages/Contracts.tsx:43"})})]})]})})}export{Ae as default};
