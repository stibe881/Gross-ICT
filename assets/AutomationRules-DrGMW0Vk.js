import{c as K,Q as ie,J as le,j as o,N as u,A as c,x as e}from"./index-BN9GAmQT.js";import{B as l}from"./button-B7XicF_D.js";import{C as j,d as v,a as D,b as I,c as ce}from"./card-DDCG5iAJ.js";import{I as P}from"./input-DAxyQcQ6.js";import{L as g}from"./label-WV9rmlgK.js";import{T as oe}from"./textarea-CUpb7IQY.js";import{S as b,a as N,b as w,c as f,d as i}from"./select-lpC4X7iX.js";import{B as F}from"./badge-DuBy3M6P.js";import{Z as V}from"./zap-BtSTIGVa.js";import{P as J}from"./plus-Bs9J4-Yt.js";import{X as ne}from"./dialog-BFxkyGdG.js";import{T as L}from"./trash-2-BGEcaC5X.js";import{L as Z}from"./loader-circle-ClqFH6Ch.js";import{S as re}from"./square-pen-CPfJwZSi.js";import"./index-Ci_qB1WW.js";import"./index-BxbciWQS.js";import"./index-DYYK5dbJ.js";import"./index-DkLA8Hun.js";import"./index-FM6g0UGI.js";import"./chevron-up-CGjsbtlF.js";import"./check-B0XS7teL.js";const ue=K("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const de=K("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);function ze(){const{user:Q}=ie(),[,W]=le(),[G,y]=o.useState(!1),[p,O]=o.useState(null),[h,k]=o.useState(""),[C,S]=o.useState(""),[_,E]=o.useState("ticket_created"),[n,d]=o.useState([{field:"priority",operator:"equals",value:"urgent"}]),[r,m]=o.useState([{type:"set_status",value:"in_progress"}]),A=u.useUtils(),{data:M,isLoading:H}=u.automation.all.useQuery(),T=u.automation.create.useMutation({onSuccess:()=>{c.success("Automatisierungsregel erstellt"),A.automation.all.invalidate(),R()},onError:t=>{c.error(t.message||"Fehler beim Erstellen")}}),z=u.automation.update.useMutation({onSuccess:()=>{c.success("Regel aktualisiert"),A.automation.all.invalidate(),R()},onError:t=>{c.error(t.message||"Fehler beim Aktualisieren")}}),U=u.automation.delete.useMutation({onSuccess:()=>{c.success("Regel gelöscht"),A.automation.all.invalidate()},onError:t=>{c.error(t.message||"Fehler beim Löschen")}}),X=u.automation.toggle.useMutation({onSuccess:()=>{c.success("Regel-Status geändert"),A.automation.all.invalidate()},onError:t=>{c.error(t.message||"Fehler")}}),R=()=>{y(!1),O(null),k(""),S(""),E("ticket_created"),d([{field:"priority",operator:"equals",value:"urgent"}]),m([{type:"set_status",value:"in_progress"}])},Y=()=>{if(!h.trim()){c.error("Bitte geben Sie einen Namen ein");return}const t=JSON.stringify(n),s=JSON.stringify(r);p?z.mutate({id:p.id,name:h,description:C,triggerType:_,conditions:t,actions:s}):T.mutate({name:h,description:C,triggerType:_,conditions:t,actions:s})},$=t=>{O(t),k(t.name),S(t.description||""),E(t.triggerType),d(JSON.parse(t.conditions)),m(JSON.parse(t.actions)),y(!0)},ee=()=>{d([...n,{field:"status",operator:"equals",value:"open"}])},te=t=>{d(n.filter((s,a)=>a!==t))},B=(t,s,a)=>{const x=[...n];x[t][s]=a,d(x)},se=()=>{m([...r,{type:"set_priority",value:"high"}])},ae=t=>{m(r.filter((s,a)=>a!==t))},q=(t,s,a)=>{const x=[...r];x[t][s]=a,m(x)};return Q?.role!=="admin"?e.jsx("div",{"data-loc":"client/src/pages/AutomationRules.tsx:168",className:"min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-900 flex items-center justify-center p-4",children:e.jsx(j,{"data-loc":"client/src/pages/AutomationRules.tsx:169",className:"bg-white/5 border-white/10",children:e.jsxs(v,{"data-loc":"client/src/pages/AutomationRules.tsx:170",className:"py-12 text-center",children:[e.jsx("p",{"data-loc":"client/src/pages/AutomationRules.tsx:171",className:"text-white",children:"Nur Administratoren haben Zugriff auf diese Seite."}),e.jsx(l,{"data-loc":"client/src/pages/AutomationRules.tsx:172",onClick:()=>W("/"),className:"mt-4",children:"Zurück zur Startseite"})]})})}):e.jsx("div",{"data-loc":"client/src/pages/AutomationRules.tsx:182",className:"min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-900 p-6",children:e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:183",className:"max-w-7xl mx-auto",children:[e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:184",className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:185",children:[e.jsxs("h1",{"data-loc":"client/src/pages/AutomationRules.tsx:186",className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(V,{"data-loc":"client/src/pages/AutomationRules.tsx:187",className:"h-8 w-8 text-primary"}),"Automatisierungsregeln"]}),e.jsx("p",{"data-loc":"client/src/pages/AutomationRules.tsx:190",className:"text-gray-400 mt-1",children:"Automatische Aktionen basierend auf Bedingungen"})]}),e.jsxs(l,{"data-loc":"client/src/pages/AutomationRules.tsx:192",onClick:()=>y(!0),className:"bg-primary hover:bg-primary/90",children:[e.jsx(J,{"data-loc":"client/src/pages/AutomationRules.tsx:196",className:"h-4 w-4 mr-2"}),"Neue Regel"]})]}),G&&e.jsxs(j,{"data-loc":"client/src/pages/AutomationRules.tsx:203",className:"bg-white/5 border-white/10 mb-6",children:[e.jsx(D,{"data-loc":"client/src/pages/AutomationRules.tsx:204",children:e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:205",className:"flex items-center justify-between",children:[e.jsx(I,{"data-loc":"client/src/pages/AutomationRules.tsx:206",className:"text-white",children:p?"Regel bearbeiten":"Neue Regel erstellen"}),e.jsx(l,{"data-loc":"client/src/pages/AutomationRules.tsx:209",variant:"ghost",size:"sm",onClick:R,children:e.jsx(ne,{"data-loc":"client/src/pages/AutomationRules.tsx:214",className:"h-4 w-4"})})]})}),e.jsxs(v,{"data-loc":"client/src/pages/AutomationRules.tsx:218",className:"space-y-6",children:[e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:220",className:"space-y-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:221",children:[e.jsx(g,{"data-loc":"client/src/pages/AutomationRules.tsx:222",className:"text-white",children:"Regelname *"}),e.jsx(P,{"data-loc":"client/src/pages/AutomationRules.tsx:223",value:h,onChange:t=>k(t.target.value),placeholder:"z.B. Dringende Tickets automatisch zuweisen",className:"bg-white/5 border-white/10 text-white"})]}),e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:230",children:[e.jsx(g,{"data-loc":"client/src/pages/AutomationRules.tsx:231",className:"text-white",children:"Beschreibung"}),e.jsx(oe,{"data-loc":"client/src/pages/AutomationRules.tsx:232",value:C,onChange:t=>S(t.target.value),placeholder:"Optionale Beschreibung...",className:"bg-white/5 border-white/10 text-white"})]}),e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:239",children:[e.jsx(g,{"data-loc":"client/src/pages/AutomationRules.tsx:240",className:"text-white",children:"Trigger"}),e.jsxs(b,{"data-loc":"client/src/pages/AutomationRules.tsx:241",value:_,onValueChange:E,children:[e.jsx(N,{"data-loc":"client/src/pages/AutomationRules.tsx:242",className:"bg-white/5 border-white/10 text-white",children:e.jsx(w,{"data-loc":"client/src/pages/AutomationRules.tsx:243"})}),e.jsxs(f,{"data-loc":"client/src/pages/AutomationRules.tsx:245",children:[e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:246",value:"ticket_created",children:"Ticket erstellt"}),e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:247",value:"ticket_updated",children:"Ticket aktualisiert"}),e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:248",value:"status_changed",children:"Status geändert"}),e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:249",value:"priority_changed",children:"Priorität geändert"})]})]})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:256",children:[e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:257",className:"flex items-center justify-between mb-3",children:[e.jsx(g,{"data-loc":"client/src/pages/AutomationRules.tsx:258",className:"text-white text-lg",children:"Bedingungen"}),e.jsxs(l,{"data-loc":"client/src/pages/AutomationRules.tsx:259",size:"sm",variant:"outline",onClick:ee,className:"border-white/20 bg-white/5 hover:bg-white/10",children:[e.jsx(J,{"data-loc":"client/src/pages/AutomationRules.tsx:265",className:"h-4 w-4 mr-1"}),"Bedingung"]})]}),e.jsx("div",{"data-loc":"client/src/pages/AutomationRules.tsx:269",className:"space-y-3",children:n.map((t,s)=>e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:271",className:"flex gap-2 items-start",children:[e.jsxs(b,{"data-loc":"client/src/pages/AutomationRules.tsx:272",value:t.field,onValueChange:a=>B(s,"field",a),children:[e.jsx(N,{"data-loc":"client/src/pages/AutomationRules.tsx:276",className:"bg-white/5 border-white/10 text-white flex-1",children:e.jsx(w,{"data-loc":"client/src/pages/AutomationRules.tsx:277"})}),e.jsxs(f,{"data-loc":"client/src/pages/AutomationRules.tsx:279",children:[e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:280",value:"status",children:"Status"}),e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:281",value:"priority",children:"Priorität"}),e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:282",value:"category",children:"Kategorie"}),e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:283",value:"subject",children:"Betreff"})]})]}),e.jsxs(b,{"data-loc":"client/src/pages/AutomationRules.tsx:286",value:t.operator,onValueChange:a=>B(s,"operator",a),children:[e.jsx(N,{"data-loc":"client/src/pages/AutomationRules.tsx:290",className:"bg-white/5 border-white/10 text-white flex-1",children:e.jsx(w,{"data-loc":"client/src/pages/AutomationRules.tsx:291"})}),e.jsxs(f,{"data-loc":"client/src/pages/AutomationRules.tsx:293",children:[e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:294",value:"equals",children:"Gleich"}),e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:295",value:"not_equals",children:"Nicht gleich"}),e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:296",value:"contains",children:"Enthält"})]})]}),e.jsx(P,{"data-loc":"client/src/pages/AutomationRules.tsx:299",value:t.value,onChange:a=>B(s,"value",a.target.value),placeholder:"Wert",className:"bg-white/5 border-white/10 text-white flex-1"}),e.jsx(l,{"data-loc":"client/src/pages/AutomationRules.tsx:305",size:"sm",variant:"ghost",onClick:()=>te(s),disabled:n.length===1,children:e.jsx(L,{"data-loc":"client/src/pages/AutomationRules.tsx:311",className:"h-4 w-4"})})]},s))})]}),e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:319",children:[e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:320",className:"flex items-center justify-between mb-3",children:[e.jsx(g,{"data-loc":"client/src/pages/AutomationRules.tsx:321",className:"text-white text-lg",children:"Aktionen"}),e.jsxs(l,{"data-loc":"client/src/pages/AutomationRules.tsx:322",size:"sm",variant:"outline",onClick:se,className:"border-white/20 bg-white/5 hover:bg-white/10",children:[e.jsx(J,{"data-loc":"client/src/pages/AutomationRules.tsx:328",className:"h-4 w-4 mr-1"}),"Aktion"]})]}),e.jsx("div",{"data-loc":"client/src/pages/AutomationRules.tsx:332",className:"space-y-3",children:r.map((t,s)=>e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:334",className:"flex gap-2 items-start",children:[e.jsxs(b,{"data-loc":"client/src/pages/AutomationRules.tsx:335",value:t.type,onValueChange:a=>q(s,"type",a),children:[e.jsx(N,{"data-loc":"client/src/pages/AutomationRules.tsx:339",className:"bg-white/5 border-white/10 text-white flex-1",children:e.jsx(w,{"data-loc":"client/src/pages/AutomationRules.tsx:340"})}),e.jsxs(f,{"data-loc":"client/src/pages/AutomationRules.tsx:342",children:[e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:343",value:"set_status",children:"Status setzen"}),e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:344",value:"set_priority",children:"Priorität setzen"}),e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:345",value:"assign_to",children:"Zuweisen an"}),e.jsx(i,{"data-loc":"client/src/pages/AutomationRules.tsx:346",value:"send_email",children:"E-Mail senden"})]})]}),e.jsx(P,{"data-loc":"client/src/pages/AutomationRules.tsx:349",value:t.value,onChange:a=>q(s,"value",a.target.value),placeholder:t.type==="send_email"?"E-Mail-Adresse":t.type==="assign_to"?"Benutzer-ID":"Wert",className:"bg-white/5 border-white/10 text-white flex-1"}),e.jsx(l,{"data-loc":"client/src/pages/AutomationRules.tsx:361",size:"sm",variant:"ghost",onClick:()=>ae(s),disabled:r.length===1,children:e.jsx(L,{"data-loc":"client/src/pages/AutomationRules.tsx:367",className:"h-4 w-4"})})]},s))})]}),e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:375",className:"flex gap-2 justify-end",children:[e.jsx(l,{"data-loc":"client/src/pages/AutomationRules.tsx:376",variant:"outline",onClick:R,children:"Abbrechen"}),e.jsxs(l,{"data-loc":"client/src/pages/AutomationRules.tsx:379",onClick:Y,disabled:T.isPending||z.isPending,className:"bg-primary hover:bg-primary/90",children:[(T.isPending||z.isPending)&&e.jsx(Z,{"data-loc":"client/src/pages/AutomationRules.tsx:385",className:"h-4 w-4 mr-2 animate-spin"}),p?"Aktualisieren":"Erstellen"]})]})]})]}),H?e.jsx("div",{"data-loc":"client/src/pages/AutomationRules.tsx:396",className:"flex justify-center py-12",children:e.jsx(Z,{"data-loc":"client/src/pages/AutomationRules.tsx:397",className:"h-8 w-8 animate-spin text-primary"})}):!M||M.length===0?e.jsx(j,{"data-loc":"client/src/pages/AutomationRules.tsx:400",className:"bg-white/5 border-white/10",children:e.jsxs(v,{"data-loc":"client/src/pages/AutomationRules.tsx:401",className:"py-12 text-center",children:[e.jsx(V,{"data-loc":"client/src/pages/AutomationRules.tsx:402",className:"h-12 w-12 mx-auto mb-4 text-gray-500"}),e.jsx("p",{"data-loc":"client/src/pages/AutomationRules.tsx:403",className:"text-gray-400",children:"Keine Automatisierungsregeln vorhanden."})]})}):e.jsx("div",{"data-loc":"client/src/pages/AutomationRules.tsx:407",className:"grid gap-4",children:M.map(t=>e.jsxs(j,{"data-loc":"client/src/pages/AutomationRules.tsx:409",className:"bg-white/5 border-white/10",children:[e.jsx(D,{"data-loc":"client/src/pages/AutomationRules.tsx:410",children:e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:411",className:"flex items-start justify-between",children:[e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:412",className:"flex-1",children:[e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:413",className:"flex items-center gap-3",children:[e.jsx(I,{"data-loc":"client/src/pages/AutomationRules.tsx:414",className:"text-white",children:t.name}),e.jsx(F,{"data-loc":"client/src/pages/AutomationRules.tsx:415",className:t.isEnabled?"bg-green-500/20 text-green-400 border-green-500/30":"bg-gray-500/20 text-gray-400 border-gray-500/30",children:t.isEnabled?"Aktiv":"Inaktiv"}),e.jsx(F,{"data-loc":"client/src/pages/AutomationRules.tsx:424",className:"bg-blue-500/20 text-blue-400 border-blue-500/30",children:t.triggerType.replace("_"," ")})]}),t.description&&e.jsx(ce,{"data-loc":"client/src/pages/AutomationRules.tsx:429",className:"text-gray-400 mt-1",children:t.description})]}),e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:434",className:"flex gap-2",children:[e.jsx(l,{"data-loc":"client/src/pages/AutomationRules.tsx:435",size:"sm",variant:"outline",onClick:()=>X.mutate({id:t.id,isEnabled:t.isEnabled?0:1}),className:"border-white/20 bg-white/5 hover:bg-white/10",children:t.isEnabled?e.jsx(ue,{"data-loc":"client/src/pages/AutomationRules.tsx:447",className:"h-4 w-4"}):e.jsx(de,{"data-loc":"client/src/pages/AutomationRules.tsx:449",className:"h-4 w-4"})}),e.jsx(l,{"data-loc":"client/src/pages/AutomationRules.tsx:452",size:"sm",variant:"outline",onClick:()=>$(t),className:"border-white/20 bg-white/5 hover:bg-white/10",children:e.jsx(re,{"data-loc":"client/src/pages/AutomationRules.tsx:458",className:"h-4 w-4"})}),e.jsx(l,{"data-loc":"client/src/pages/AutomationRules.tsx:460",size:"sm",variant:"destructive",onClick:()=>{confirm("Möchten Sie diese Regel wirklich löschen?")&&U.mutate({id:t.id})},children:e.jsx(L,{"data-loc":"client/src/pages/AutomationRules.tsx:469",className:"h-4 w-4"})})]})]})}),e.jsx(v,{"data-loc":"client/src/pages/AutomationRules.tsx:474",children:e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:475",className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:476",children:[e.jsx("h4",{"data-loc":"client/src/pages/AutomationRules.tsx:477",className:"text-sm font-medium text-gray-400 mb-2",children:"Bedingungen:"}),e.jsx("div",{"data-loc":"client/src/pages/AutomationRules.tsx:478",className:"space-y-1",children:JSON.parse(t.conditions).map((s,a)=>e.jsxs("p",{"data-loc":"client/src/pages/AutomationRules.tsx:480",className:"text-sm text-white",children:["• ",s.field," ",s.operator,' "',s.value,'"']},a))})]}),e.jsxs("div",{"data-loc":"client/src/pages/AutomationRules.tsx:486",children:[e.jsx("h4",{"data-loc":"client/src/pages/AutomationRules.tsx:487",className:"text-sm font-medium text-gray-400 mb-2",children:"Aktionen:"}),e.jsx("div",{"data-loc":"client/src/pages/AutomationRules.tsx:488",className:"space-y-1",children:JSON.parse(t.actions).map((s,a)=>e.jsxs("p",{"data-loc":"client/src/pages/AutomationRules.tsx:490",className:"text-sm text-white",children:["• ",s.type.replace("_"," "),': "',s.value,'"']},a))})]})]})})]},t.id))})]})})}export{ze as default};
