import{j as b,N as x,A as p,x as e}from"./index-BN9GAmQT.js";import{L as D}from"./LoadingSkeleton-DmaNQS4_.js";import{B as r}from"./button-B7XicF_D.js";import{C as j}from"./card-DDCG5iAJ.js";import{D as k,a as P,b as A,c as M}from"./dialog-BFxkyGdG.js";import{I as o}from"./input-DAxyQcQ6.js";import{L as d}from"./label-WV9rmlgK.js";import{T as z}from"./textarea-CUpb7IQY.js";import{S as N,a as y,b as w,c as C,d as m}from"./select-lpC4X7iX.js";import{P as f}from"./plus-Bs9J4-Yt.js";import{P as L,a as E}from"./play-l-NmOMZ4.js";import{T as S}from"./trash-2-BGEcaC5X.js";import{C as T}from"./calendar-lP7qctBn.js";import"./skeleton-B4p3r7MP.js";import"./index-Ci_qB1WW.js";import"./index-DkLA8Hun.js";import"./index-BxbciWQS.js";import"./index-DYYK5dbJ.js";import"./index-FM6g0UGI.js";import"./chevron-up-CGjsbtlF.js";import"./check-B0XS7teL.js";function ae(){const[v,l]=b.useState(!1),{data:g,isLoading:c,refetch:t}=x.recurringInvoices.all.useQuery(),{data:u}=x.customers.all.useQuery(),h=x.recurringInvoices.toggleActive.useMutation({onSuccess:()=>{p.success("Status aktualisiert"),t()}}),I=x.recurringInvoices.delete.useMutation({onSuccess:()=>{p.success("Wiederkehrende Rechnung gelöscht"),t()}}),R=s=>{switch(s){case"monthly":return"Monatlich";case"quarterly":return"Vierteljährlich";case"yearly":return"Jährlich";default:return s}};return c?e.jsx("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:51",className:"space-y-6 p-6",children:e.jsx(D,{"data-loc":"client/src/pages/RecurringInvoices.tsx:52",variant:"table",rows:5})}):e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:58",className:"space-y-6",children:[e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:59",className:"flex justify-between items-center",children:[e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:60",children:[e.jsx("h2",{"data-loc":"client/src/pages/RecurringInvoices.tsx:61",className:"text-2xl font-bold",children:"Wiederkehrende Rechnungen"}),e.jsx("p",{"data-loc":"client/src/pages/RecurringInvoices.tsx:62",className:"text-muted-foreground",children:"Automatische Rechnungserstellung verwalten"})]}),e.jsxs(r,{"data-loc":"client/src/pages/RecurringInvoices.tsx:64",onClick:()=>l(!0),children:[e.jsx(f,{"data-loc":"client/src/pages/RecurringInvoices.tsx:65",className:"w-4 h-4 mr-2"}),"Neue erstellen"]})]}),e.jsx("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:70",className:"grid gap-4",children:g&&g.length>0?g.map(s=>e.jsx(j,{"data-loc":"client/src/pages/RecurringInvoices.tsx:73",className:"p-6",children:e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:74",className:"flex justify-between items-start",children:[e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:75",className:"space-y-2 flex-1",children:[e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:76",className:"flex items-center gap-3",children:[e.jsx("h3",{"data-loc":"client/src/pages/RecurringInvoices.tsx:77",className:"text-lg font-semibold",children:s.templateName}),e.jsx("span",{"data-loc":"client/src/pages/RecurringInvoices.tsx:78",className:`px-2 py-1 text-xs rounded-full ${s.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.isActive?"Aktiv":"Pausiert"})]}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:87",className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:88",children:[e.jsx("p",{"data-loc":"client/src/pages/RecurringInvoices.tsx:89",className:"text-muted-foreground",children:"Kunde"}),e.jsx("p",{"data-loc":"client/src/pages/RecurringInvoices.tsx:90",className:"font-medium",children:s.customer?.name||"Unbekannt"})]}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:92",children:[e.jsx("p",{"data-loc":"client/src/pages/RecurringInvoices.tsx:93",className:"text-muted-foreground",children:"Intervall"}),e.jsx("p",{"data-loc":"client/src/pages/RecurringInvoices.tsx:94",className:"font-medium",children:R(s.interval)})]}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:96",children:[e.jsx("p",{"data-loc":"client/src/pages/RecurringInvoices.tsx:97",className:"text-muted-foreground",children:"Nächste Ausführung"}),e.jsx("p",{"data-loc":"client/src/pages/RecurringInvoices.tsx:98",className:"font-medium",children:new Date(s.nextRunDate).toLocaleDateString("de-CH")})]}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:102",children:[e.jsx("p",{"data-loc":"client/src/pages/RecurringInvoices.tsx:103",className:"text-muted-foreground",children:"Letzte Ausführung"}),e.jsx("p",{"data-loc":"client/src/pages/RecurringInvoices.tsx:104",className:"font-medium",children:s.lastRunDate?new Date(s.lastRunDate).toLocaleDateString("de-CH"):"Noch nie"})]})]}),s.notes&&e.jsx("p",{"data-loc":"client/src/pages/RecurringInvoices.tsx:114",className:"text-sm text-muted-foreground mt-2",children:s.notes})]}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:118",className:"flex gap-2 ml-4",children:[e.jsx(r,{"data-loc":"client/src/pages/RecurringInvoices.tsx:119",variant:"outline",size:"sm",onClick:()=>h.mutate({id:s.id,isActive:!s.isActive}),children:s.isActive?e.jsxs(e.Fragment,{children:[e.jsx(L,{"data-loc":"client/src/pages/RecurringInvoices.tsx:128",className:"w-4 h-4 mr-1"})," Pausieren"]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{"data-loc":"client/src/pages/RecurringInvoices.tsx:130",className:"w-4 h-4 mr-1"})," Aktivieren"]})}),e.jsx(r,{"data-loc":"client/src/pages/RecurringInvoices.tsx:133",variant:"outline",size:"sm",onClick:()=>{confirm("Möchten Sie diese wiederkehrende Rechnung wirklich löschen?")&&I.mutate({id:s.id})},children:e.jsx(S,{"data-loc":"client/src/pages/RecurringInvoices.tsx:142",className:"w-4 h-4"})})]})]})},s.id)):e.jsxs(j,{"data-loc":"client/src/pages/RecurringInvoices.tsx:149",className:"p-12 text-center",children:[e.jsx(T,{"data-loc":"client/src/pages/RecurringInvoices.tsx:150",className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{"data-loc":"client/src/pages/RecurringInvoices.tsx:151",className:"text-lg font-semibold mb-2",children:"Keine wiederkehrenden Rechnungen"}),e.jsx("p",{"data-loc":"client/src/pages/RecurringInvoices.tsx:152",className:"text-muted-foreground mb-4",children:"Erstellen Sie automatische Rechnungen für wiederkehrende Services"}),e.jsxs(r,{"data-loc":"client/src/pages/RecurringInvoices.tsx:155",onClick:()=>l(!0),children:[e.jsx(f,{"data-loc":"client/src/pages/RecurringInvoices.tsx:156",className:"w-4 h-4 mr-2"}),"Erste Rechnung erstellen"]})]})}),v&&e.jsx(q,{"data-loc":"client/src/pages/RecurringInvoices.tsx:164",customers:u||[],onClose:()=>l(!1),onSuccess:()=>{l(!1),t()}})]})}function q({customers:v,onClose:l,onSuccess:g}){const[c,t]=b.useState({customerId:"",templateName:"",interval:"monthly",nextRunDate:new Date().toISOString().split("T")[0],notes:"",items:[{description:"",quantity:"1",unit:"Monat",unitPrice:"0",vatRate:"8.1",discount:"0"}]}),u=x.recurringInvoices.create.useMutation({onSuccess:()=>{p.success("Wiederkehrende Rechnung erstellt"),g()}}),h=()=>{if(!c.customerId||!c.templateName||c.items.length===0){p.error("Bitte füllen Sie alle Pflichtfelder aus");return}u.mutate({customerId:parseInt(c.customerId),templateName:c.templateName,interval:c.interval,nextRunDate:c.nextRunDate,notes:c.notes,items:c.items})},I=()=>{t({...c,items:[...c.items,{description:"",quantity:"1",unit:"Monat",unitPrice:"0",vatRate:"8.1",discount:"0"}]})},R=s=>{t({...c,items:c.items.filter((i,a)=>a!==s)})};return e.jsx(k,{"data-loc":"client/src/pages/RecurringInvoices.tsx:244",open:!0,onOpenChange:l,children:e.jsxs(P,{"data-loc":"client/src/pages/RecurringInvoices.tsx:245",className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(A,{"data-loc":"client/src/pages/RecurringInvoices.tsx:246",children:e.jsx(M,{"data-loc":"client/src/pages/RecurringInvoices.tsx:247",children:"Wiederkehrende Rechnung erstellen"})}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:250",className:"space-y-4 mt-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:251",className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:252",children:[e.jsx(d,{"data-loc":"client/src/pages/RecurringInvoices.tsx:253",children:"Vorlagenname *"}),e.jsx(o,{"data-loc":"client/src/pages/RecurringInvoices.tsx:254",value:c.templateName,onChange:s=>t({...c,templateName:s.target.value}),placeholder:"z.B. Monatliches Hosting"})]}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:260",children:[e.jsx(d,{"data-loc":"client/src/pages/RecurringInvoices.tsx:261",children:"Kunde *"}),e.jsxs(N,{"data-loc":"client/src/pages/RecurringInvoices.tsx:262",value:c.customerId,onValueChange:s=>t({...c,customerId:s}),children:[e.jsx(y,{"data-loc":"client/src/pages/RecurringInvoices.tsx:266",children:e.jsx(w,{"data-loc":"client/src/pages/RecurringInvoices.tsx:267",placeholder:"Kunde auswählen"})}),e.jsx(C,{"data-loc":"client/src/pages/RecurringInvoices.tsx:269",children:v.map(s=>e.jsx(m,{"data-loc":"client/src/pages/RecurringInvoices.tsx:271",value:String(s.id),children:s.name},s.id))})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:278",children:[e.jsx(d,{"data-loc":"client/src/pages/RecurringInvoices.tsx:279",children:"Intervall"}),e.jsxs(N,{"data-loc":"client/src/pages/RecurringInvoices.tsx:280",value:c.interval,onValueChange:s=>t({...c,interval:s}),children:[e.jsx(y,{"data-loc":"client/src/pages/RecurringInvoices.tsx:284",children:e.jsx(w,{"data-loc":"client/src/pages/RecurringInvoices.tsx:285"})}),e.jsxs(C,{"data-loc":"client/src/pages/RecurringInvoices.tsx:287",children:[e.jsx(m,{"data-loc":"client/src/pages/RecurringInvoices.tsx:288",value:"monthly",children:"Monatlich"}),e.jsx(m,{"data-loc":"client/src/pages/RecurringInvoices.tsx:289",value:"quarterly",children:"Vierteljährlich"}),e.jsx(m,{"data-loc":"client/src/pages/RecurringInvoices.tsx:290",value:"yearly",children:"Jährlich"})]})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:294",children:[e.jsx(d,{"data-loc":"client/src/pages/RecurringInvoices.tsx:295",children:"Nächste Ausführung"}),e.jsx(o,{"data-loc":"client/src/pages/RecurringInvoices.tsx:296",type:"date",value:c.nextRunDate,onChange:s=>t({...c,nextRunDate:s.target.value})})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:304",children:[e.jsx(d,{"data-loc":"client/src/pages/RecurringInvoices.tsx:305",children:"Notizen"}),e.jsx(z,{"data-loc":"client/src/pages/RecurringInvoices.tsx:306",value:c.notes,onChange:s=>t({...c,notes:s.target.value}),placeholder:"Interne Notizen..."})]}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:313",children:[e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:314",className:"flex justify-between items-center mb-2",children:[e.jsx(d,{"data-loc":"client/src/pages/RecurringInvoices.tsx:315",children:"Positionen *"}),e.jsxs(r,{"data-loc":"client/src/pages/RecurringInvoices.tsx:316",type:"button",variant:"outline",size:"sm",onClick:I,children:[e.jsx(f,{"data-loc":"client/src/pages/RecurringInvoices.tsx:317",className:"w-4 h-4 mr-1"}),"Position hinzufügen"]})]}),e.jsx("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:322",className:"space-y-3",children:c.items.map((s,i)=>e.jsx(j,{"data-loc":"client/src/pages/RecurringInvoices.tsx:324",className:"p-4",children:e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:325",className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:326",className:"col-span-2",children:e.jsx(o,{"data-loc":"client/src/pages/RecurringInvoices.tsx:327",placeholder:"Beschreibung",value:s.description,onChange:a=>{const n=[...c.items];n[i].description=a.target.value,t({...c,items:n})}})}),e.jsx(o,{"data-loc":"client/src/pages/RecurringInvoices.tsx:337",placeholder:"Menge",type:"number",value:s.quantity,onChange:a=>{const n=[...c.items];n[i].quantity=a.target.value,t({...c,items:n})}}),e.jsx(o,{"data-loc":"client/src/pages/RecurringInvoices.tsx:347",placeholder:"Einheit",value:s.unit,onChange:a=>{const n=[...c.items];n[i].unit=a.target.value,t({...c,items:n})}}),e.jsx(o,{"data-loc":"client/src/pages/RecurringInvoices.tsx:356",placeholder:"Preis",type:"number",step:"0.01",value:s.unitPrice,onChange:a=>{const n=[...c.items];n[i].unitPrice=a.target.value,t({...c,items:n})}}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:367",className:"flex gap-2",children:[e.jsx(o,{"data-loc":"client/src/pages/RecurringInvoices.tsx:368",placeholder:"MwSt %",type:"number",step:"0.1",value:s.vatRate,onChange:a=>{const n=[...c.items];n[i].vatRate=a.target.value,t({...c,items:n})}}),c.items.length>1&&e.jsx(r,{"data-loc":"client/src/pages/RecurringInvoices.tsx:380",type:"button",variant:"outline",size:"sm",onClick:()=>R(i),children:e.jsx(S,{"data-loc":"client/src/pages/RecurringInvoices.tsx:386",className:"w-4 h-4"})})]})]})},i))})]}),e.jsxs("div",{"data-loc":"client/src/pages/RecurringInvoices.tsx:396",className:"flex justify-end gap-2 pt-4",children:[e.jsx(r,{"data-loc":"client/src/pages/RecurringInvoices.tsx:397",variant:"outline",onClick:l,children:"Abbrechen"}),e.jsx(r,{"data-loc":"client/src/pages/RecurringInvoices.tsx:400",onClick:h,disabled:u.isPending,children:u.isPending?"Erstelle...":"Erstellen"})]})]})]})})}export{ae as default};
