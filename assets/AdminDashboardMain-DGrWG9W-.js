import{c as A,J as N,j as h,N as x,x as e,Q as M,T as k,A as v,S as w}from"./index-BN9GAmQT.js";import{B as p}from"./button-B7XicF_D.js";import{C as g,a as u,b as f,c as b,d as D}from"./card-DDCG5iAJ.js";import{D as y,a as B,b as T,c as C,d as S}from"./dropdown-menu-CPeOI1vM.js";import{B as L}from"./bell-zmoD-L3x.js";import{R as j}from"./receipt-UyHtgOCh.js";import{U as I}from"./users-BEPVjVsG.js";import{F as E}from"./file-text-zOWEdpec.js";import{B as R}from"./book-open-DJlXj3jr.js";import{S as K}from"./settings-Cg8CoMio.js";import{T as $}from"./ticket-BVKPZXvN.js";import{C as z}from"./chart-column-8Hy86w9_.js";import{M as F}from"./mail-fgvT38PL.js";import{S as Q}from"./server-Bx80iglh.js";import{L as U}from"./log-out-Del1bcAp.js";import{T as P}from"./trending-up-q9Xt4TNZ.js";import{T as V}from"./trending-down-DxdrgmSb.js";import"./index-Ci_qB1WW.js";import"./index-DYYK5dbJ.js";import"./index-DkLA8Hun.js";import"./index-DE5s7y_t.js";const W=A("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);function O(){const[,n]=N(),[o,r]=h.useState(0),{data:i=[]}=x.mention.getUnreadMentions.useQuery(void 0,{refetchInterval:3e4}),s=x.mention.markAsRead.useMutation({onSuccess:()=>{window.location.reload()}});h.useEffect(()=>{r(i.length)},[i]);const d=(a,c)=>{s.mutate({mentionId:c}),n(`/admin?ticket=${a}`)},m=a=>{const c=new Date,t=new Date(a),l=Math.floor((c.getTime()-t.getTime())/1e3);return l<60?"Gerade eben":l<3600?`vor ${Math.floor(l/60)}m`:l<86400?`vor ${Math.floor(l/3600)}h`:`vor ${Math.floor(l/86400)}d`};return e.jsxs(y,{"data-loc":"client/src/components/NotificationBell.tsx:55",children:[e.jsx(B,{"data-loc":"client/src/components/NotificationBell.tsx:56",asChild:!0,children:e.jsxs(p,{"data-loc":"client/src/components/NotificationBell.tsx:57",variant:"ghost",size:"icon",className:"relative hover:bg-white/10",children:[e.jsx(L,{"data-loc":"client/src/components/NotificationBell.tsx:62",className:"h-5 w-5 text-white"}),o>0&&e.jsx("span",{"data-loc":"client/src/components/NotificationBell.tsx:64",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-yellow-500 text-black text-xs font-bold flex items-center justify-center",children:o>9?"9+":o})]})}),e.jsxs(T,{"data-loc":"client/src/components/NotificationBell.tsx:70",align:"end",className:"w-80 bg-gray-900 border-white/10",children:[e.jsxs("div",{"data-loc":"client/src/components/NotificationBell.tsx:71",className:"px-4 py-3 border-b border-white/10",children:[e.jsx("h3",{"data-loc":"client/src/components/NotificationBell.tsx:72",className:"font-semibold text-white",children:"Benachrichtigungen"}),o>0&&e.jsxs("p",{"data-loc":"client/src/components/NotificationBell.tsx:74",className:"text-xs text-gray-400",children:[o," ungelesene"]})]}),i.length===0?e.jsx("div",{"data-loc":"client/src/components/NotificationBell.tsx:79",className:"px-4 py-8 text-center text-gray-400 text-sm",children:"Keine neuen Benachrichtigungen"}):e.jsx("div",{"data-loc":"client/src/components/NotificationBell.tsx:83",className:"max-h-96 overflow-y-auto",children:i.map(a=>e.jsx(C,{"data-loc":"client/src/components/NotificationBell.tsx:85",className:"px-4 py-3 cursor-pointer hover:bg-white/5 focus:bg-white/5 border-b border-white/5",onClick:()=>d(a.ticketId,a.id),children:e.jsxs("div",{"data-loc":"client/src/components/NotificationBell.tsx:90",className:"flex flex-col gap-1 w-full",children:[e.jsxs("div",{"data-loc":"client/src/components/NotificationBell.tsx:91",className:"flex items-center justify-between",children:[e.jsxs("p",{"data-loc":"client/src/components/NotificationBell.tsx:92",className:"text-sm font-medium text-white",children:[a.mentionedByName," hat Sie erwähnt"]}),e.jsx("span",{"data-loc":"client/src/components/NotificationBell.tsx:95",className:"text-xs text-gray-400",children:m(a.createdAt)})]}),e.jsxs("p",{"data-loc":"client/src/components/NotificationBell.tsx:99",className:"text-xs text-gray-400",children:["Ticket #",a.ticketId,": ",a.ticketSubject]}),a.commentText&&e.jsx("p",{"data-loc":"client/src/components/NotificationBell.tsx:103",className:"text-xs text-gray-300 line-clamp-2 mt-1",children:a.commentText})]})},a.id))}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(S,{"data-loc":"client/src/components/NotificationBell.tsx:115",className:"bg-white/10"}),e.jsx("div",{"data-loc":"client/src/components/NotificationBell.tsx:116",className:"px-4 py-2",children:e.jsx(p,{"data-loc":"client/src/components/NotificationBell.tsx:117",variant:"ghost",size:"sm",className:"w-full text-yellow-400 hover:text-yellow-300 hover:bg-white/5",onClick:()=>{i.forEach(a=>{s.mutate({mentionId:a.id})})},children:"Alle als gelesen markieren"})})]})]})]})}function G(){const{data:n,isLoading:o,refetch:r}=x.dashboardStats.getQuickStats.useQuery(),[,i]=N(),{socket:s,connected:d}=w();if(h.useEffect(()=>{if(!s||!d)return;const t=()=>{console.log("[Dashboard] Received stats update event, refetching..."),r()};return s.on("ticket:created",t),s.on("ticket:updated",t),s.on("customer:created",t),s.on("invoice:created",t),s.on("invoice:updated",t),s.on("kb:created",t),s.on("stats:refresh",t),()=>{s.off("ticket:created",t),s.off("ticket:updated",t),s.off("customer:created",t),s.off("invoice:created",t),s.off("invoice:updated",t),s.off("kb:created",t),s.off("stats:refresh",t)}},[s,d,r]),o)return e.jsx("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:48",className:"mt-12 grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(t=>e.jsx(g,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:50",children:e.jsxs(u,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:51",className:"pb-2",children:[e.jsx(b,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:52",children:"Laden..."}),e.jsx(f,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:53",className:"text-3xl",children:"--"})]})},t))});const m=[{label:"Offene Tickets",value:n?.openTickets||0,trend:n?.openTicketsTrend||0,path:"/admin/tickets",color:"from-orange-500 to-red-600"},{label:"Kunden",value:n?.totalCustomers||0,trend:n?.customersTrend||0,path:"/crm",color:"from-blue-500 to-cyan-600"},{label:"Offene Rechnungen",value:n?.openInvoices||0,trend:n?.openInvoicesTrend||0,path:"/accounting",color:"from-green-500 to-emerald-600"},{label:"KB-Artikel",value:n?.totalKbArticles||0,trend:n?.kbArticlesTrend||0,path:"/admin/knowledge-base",color:"from-purple-500 to-pink-600"}],a=t=>t>0?e.jsx(P,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:93",className:"h-4 w-4 text-green-500"}):t<0?e.jsx(V,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:94",className:"h-4 w-4 text-red-500"}):e.jsx(W,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:95",className:"h-4 w-4 text-gray-400"}),c=t=>t===0?"Keine Änderung":`${t>0?"+":""}${t} seit letzter Woche`;return e.jsx("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:105",className:"mt-12 grid grid-cols-1 md:grid-cols-4 gap-4",children:m.map(t=>e.jsxs(g,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:107",className:"cursor-pointer hover:shadow-lg transition-all duration-300 hover:-translate-y-1 border-border/50 group",onClick:()=>i(t.path),children:[e.jsx("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:112",className:`h-1 bg-gradient-to-r ${t.color} group-hover:h-2 transition-all`}),e.jsxs(u,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:113",className:"pb-2",children:[e.jsx(b,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:114",className:"group-hover:text-primary transition-colors",children:t.label}),e.jsxs("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:117",className:"flex items-baseline gap-3",children:[e.jsx(f,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:118",className:"text-3xl group-hover:text-primary transition-colors",children:t.value}),e.jsx("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:121",className:"flex items-center gap-1 text-xs",children:a(t.trend)})]}),e.jsx("p",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:125",className:"text-xs text-muted-foreground mt-1",children:c(t.trend)})]})]},t.label))})}function xe(){const{user:n,logout:o,loading:r}=M(),[,i]=N();if(!r&&n?.role!=="admin")return i("/"),null;if(r)return e.jsx("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:147",className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:148",className:"text-center",children:[e.jsx("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:149",className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:150",className:"mt-4 text-muted-foreground",children:"Laden..."})]})});const s=async()=>{try{await o(),v.success("Erfolgreich abgemeldet"),i("/")}catch{v.error("Fehler beim Abmelden")}},m=[{id:"buchhaltung",title:"Buchhaltung",description:"Rechnungen, Angebote, Zahlungen und Finanzen verwalten",icon:j,path:"/accounting",color:"from-green-500 to-emerald-600",permission:"admin"},{id:"crm",title:"CRM",description:"Kundenverwaltung, Kontakte und Beziehungen",icon:I,path:"/crm",color:"from-blue-500 to-cyan-600",permission:"admin"},{id:"vertraege",title:"Verträge",description:"Kundenverträge, Vorlagen und SLA-Management",icon:E,path:"/contracts",color:"from-teal-500 to-cyan-600",permission:"admin"},{id:"wissensdatenbank",title:"Wissensdatenbank",description:"Artikel, Dokumentation und FAQ verwalten",icon:R,path:"/admin/knowledge-base",color:"from-purple-500 to-pink-600",permission:"admin"},{id:"verwaltung",title:"Verwaltung",description:"Benutzer, Einstellungen und Systemkonfiguration",icon:K,path:"/admin/users",color:"from-gray-500 to-slate-600",permission:"admin"},{id:"tickets",title:"Tickets",description:"Support-Tickets, Anfragen und Probleme verwalten",icon:$,path:"/admin/tickets",color:"from-orange-500 to-red-600",permission:"user"},{id:"statistiken",title:"Statistiken",description:"Dashboard, Charts und Performance-Metriken",icon:z,path:"/financial-dashboard",color:"from-indigo-500 to-blue-600",permission:"admin"},{id:"newsletter",title:"Newsletter",description:"Newsletter-Kampagnen, Abonnenten und E-Mail-Marketing",icon:F,path:"/newsletter",color:"from-pink-500 to-rose-600",permission:"admin"},{id:"products",title:"Produkte",description:"Produktkatalog, Preise und Leistungen verwalten",icon:j,path:"/products",color:"from-emerald-500 to-green-600",permission:"admin"},{id:"email-templates",title:"Email Templates",description:"E-Mail-Vorlagen erstellen und verwalten",icon:Q,path:"/smtp-settings",color:"from-yellow-500 to-amber-600",permission:"admin"},{id:"sla-reports",title:"SLA Reports",description:"Service Level Agreement Berichte und Analysen",icon:k,path:"/sla-reports",color:"from-red-500 to-orange-600",permission:"admin"}].filter(a=>a.permission==="admin"?n?.role==="admin":!0);return e.jsxs("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:280",className:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20",children:[e.jsx("header",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:282",className:"border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-50",children:e.jsxs("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:283",className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:284",children:[e.jsx("h1",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:285",className:"text-2xl font-bold",children:"Admin Dashboard"}),e.jsxs("p",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:286",className:"text-sm text-muted-foreground",children:["Willkommen, ",n?.name]})]}),e.jsxs("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:288",className:"flex items-center gap-2",children:[e.jsx(O,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:289"}),e.jsxs(p,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:290",variant:"outline",onClick:s,children:[e.jsx(U,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:291",className:"h-4 w-4 mr-2"}),"Abmelden"]})]})]})}),e.jsxs("main",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:299",className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:300",className:"mb-8",children:[e.jsx("h2",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:301",className:"text-3xl font-bold mb-2",children:"Wählen Sie einen Bereich"}),e.jsx("p",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:302",className:"text-muted-foreground",children:"Navigieren Sie zu den verschiedenen Verwaltungsbereichen"})]}),e.jsx("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:308",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(a=>{const c=a.icon;return e.jsxs(g,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:312",className:"group cursor-pointer hover:shadow-lg transition-all duration-300 hover:-translate-y-1 border-border/50 overflow-hidden",onClick:()=>i(a.path),children:[e.jsx("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:317",className:`h-2 bg-gradient-to-r ${a.color}`}),e.jsxs(u,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:318",children:[e.jsx("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:319",className:"flex items-start justify-between",children:e.jsx("div",{"data-loc":"client/src/pages/AdminDashboardMain.tsx:320",className:`p-3 rounded-lg bg-gradient-to-br ${a.color} text-white`,children:e.jsx(c,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:321",className:"h-6 w-6"})})}),e.jsx(f,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:324",className:"mt-4 group-hover:text-primary transition-colors",children:a.title}),e.jsx(b,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:327",className:"text-sm",children:a.description})]}),e.jsx(D,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:331",children:e.jsx(p,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:332",variant:"ghost",className:"w-full group-hover:bg-primary/10 group-hover:text-primary transition-colors",children:"Öffnen →"})})]},a.id)})}),e.jsx(G,{"data-loc":"client/src/pages/AdminDashboardMain.tsx:345"})]})]})}export{xe as default};
